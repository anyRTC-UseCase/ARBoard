/*!
  * ar-whiteboard v1.0.10
  * (c) 2022 anyRTC WhiteBoard SDK
  * @license MIT
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).self=t.self||{})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,o){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},e(t,o)};function o(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}var i=function(){return i=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},i.apply(this,arguments)};function n(t,e,o,i){return new(o||(o=Promise))((function(n,r){function s(t){try{h(i.next(t))}catch(t){r(t)}}function a(t){try{h(i.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,a)}h((i=i.apply(t,e||[])).next())}))}function r(t,e){var o,i,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],i=0}finally{o=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}function s(t){var e="function"==typeof Symbol&&Symbol.iterator,o=e&&t[e],i=0;if(o)return o.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var i,n,r=o.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(t){n={error:t}}finally{try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(n)throw n.error}}return s}function h(t,e,o){if(o||2===arguments.length)for(var i,n=0,r=e.length;n<r;n++)!i&&n in e||(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))}var c,l={SDK_VERSION:"1.0.10",GATEWAY_ADDRESS:"https://wbgw.agrtc.cn",GATEWAY_ADDRESS1:"https://wbgw.agrtc.cn",GATEWAY_ADDRESS_SSL:!0,GATEWAY_CONNECT_TIMEOUT:2e3,REPORT_DOMAIN:"",REPORT_BACKUP_DOMAIN:"",LOADING_ICON:"data:image/svg+xml,%3c%3fxml version='1.0' encoding='UTF-8'%3f%3e%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' style='margin: auto%3b display: block%3b' width='140px' height='140px' viewBox='0 0 100 100' preserveAspectRatio='xMidYMid'%3e %3cdefs%3e %3cfilter id='filter' x='-100%25' y='-100%25' width='300%25' height='300%25' color-interpolation-filters='sRGB'%3e %3cfeGaussianBlur in='SourceGraphic' stdDeviation='2.4000000000000004'%3e%3c/feGaussianBlur%3e %3cfeComponentTransfer result='cutoff'%3e %3cfeFuncA type='table' tableValues='0 0 0 0 0 0 1 1 1 1 1'%3e%3c/feFuncA%3e %3c/feComponentTransfer%3e %3c/filter%3e %3c/defs%3e %3cg filter='url(%23filter)'%3e%3cg transform='translate(50 50)'%3e %3cg%3e %3ccircle cx='17' cy='0' r='5' fill='%23220b09'%3e %3canimate attributeName='r' keyTimes='0%3b0.5%3b1' values='3.5999999999999996%3b8.399999999999999%3b3.5999999999999996' dur='4s' repeatCount='indefinite' begin='-0.25s'%3e%3c/animate%3e %3c/circle%3e %3canimateTransform attributeName='transform' type='rotate' keyTimes='0%3b1' values='0%3b360' dur='4s' repeatCount='indefinite' begin='0s'%3e%3c/animateTransform%3e %3c/g%3e %3c/g%3e%3cg transform='translate(50 50)'%3e %3cg%3e %3ccircle cx='17' cy='0' r='5' fill='%23d34c31'%3e %3canimate attributeName='r' keyTimes='0%3b0.5%3b1' values='3.5999999999999996%3b8.399999999999999%3b3.5999999999999996' dur='2s' repeatCount='indefinite' begin='-0.20833333333333334s'%3e%3c/animate%3e %3c/circle%3e %3canimateTransform attributeName='transform' type='rotate' keyTimes='0%3b1' values='0%3b360' dur='2s' repeatCount='indefinite' begin='-0.041666666666666664s'%3e%3c/animateTransform%3e %3c/g%3e %3c/g%3e%3cg transform='translate(50 50)'%3e %3cg%3e %3ccircle cx='17' cy='0' r='5' fill='%23e88432'%3e %3canimate attributeName='r' keyTimes='0%3b0.5%3b1' values='3.5999999999999996%3b8.399999999999999%3b3.5999999999999996' dur='1.3333333333333333s' repeatCount='indefinite' begin='-0.16666666666666666s'%3e%3c/animate%3e %3c/circle%3e %3canimateTransform attributeName='transform' type='rotate' keyTimes='0%3b1' values='0%3b360' dur='1.3333333333333333s' repeatCount='indefinite' begin='-0.08333333333333333s'%3e%3c/animateTransform%3e %3c/g%3e %3c/g%3e%3cg transform='translate(50 50)'%3e %3cg%3e %3ccircle cx='17' cy='0' r='5' fill='%23ff312d'%3e %3canimate attributeName='r' keyTimes='0%3b0.5%3b1' values='3.5999999999999996%3b8.399999999999999%3b3.5999999999999996' dur='1s' repeatCount='indefinite' begin='-0.125s'%3e%3c/animate%3e %3c/circle%3e %3canimateTransform attributeName='transform' type='rotate' keyTimes='0%3b1' values='0%3b360' dur='1s' repeatCount='indefinite' begin='-0.125s'%3e%3c/animateTransform%3e %3c/g%3e %3c/g%3e%3cg transform='translate(50 50)'%3e %3cg%3e %3ccircle cx='17' cy='0' r='5' fill='%23f5c037'%3e %3canimate attributeName='r' keyTimes='0%3b0.5%3b1' values='3.5999999999999996%3b8.399999999999999%3b3.5999999999999996' dur='0.8s' repeatCount='indefinite' begin='-0.08333333333333333s'%3e%3c/animate%3e %3c/circle%3e %3canimateTransform attributeName='transform' type='rotate' keyTimes='0%3b1' values='0%3b360' dur='0.8s' repeatCount='indefinite' begin='-0.16666666666666666s'%3e%3c/animateTransform%3e %3c/g%3e %3c/g%3e%3cg transform='translate(50 50)'%3e %3cg%3e %3ccircle cx='17' cy='0' r='5' fill='%23e89788'%3e %3canimate attributeName='r' keyTimes='0%3b0.5%3b1' values='3.5999999999999996%3b8.399999999999999%3b3.5999999999999996' dur='0.6666666666666666s' repeatCount='indefinite' begin='-0.041666666666666664s'%3e%3c/animate%3e %3c/circle%3e %3canimateTransform attributeName='transform' type='rotate' keyTimes='0%3b1' values='0%3b360' dur='0.6666666666666666s' repeatCount='indefinite' begin='-0.20833333333333334s'%3e%3c/animateTransform%3e %3c/g%3e %3c/g%3e%3c/g%3e%3c/svg%3e",BOARD_BACKGROUND_COLOR:"#FFFFFF",BOARD_SELECT_STYLE:{lineDash:[5,5],lineWidth:1,strokeStyle:"#ababab"},SHAPE_SELECT_STYLE:{lineDash:[8,8],strokeStyle:"#ababab",lineWidth:1},TEXT_INPUT_ELEMENT_OPTIONS:{kind:"textarea",props:{"has-origin-text":"0",spellCheck:!1},style:{":focus-border":"1px solid red","z-index":"9",position:"absolute",display:"inline-block","backface-visibility":"hidden",margin:"0px",padding:"0px",outline:"none",resize:"none",background:"transparent",overflow:"hidden","white-space":"pre-wrap","word-break":"break-all","font-family":"customFontFamily , sans-serif, serif, monospace","font-style":"normal","font-weight":"normal",top:"0px",left:"0px","min-width":"12px","min-height":"12px",width:"12px",height:"12px",border:"1px solid transparent","box-sizing":"content-box",color:"#333333","font-size":"12px","line-height":"12px"}},CONTROL_DIR_STYLE:{position:"absolute",width:"8px",height:"8px",background:"red","background-clip":"padding-box",border:"2px solid transparent","box-sizing":"content-box"}};t.EBoardErrorCode=void 0,(c=t.EBoardErrorCode||(t.EBoardErrorCode={}))[c.INIT_ERROR=1]="INIT_ERROR",c[c.AUTH_FAILED=2]="AUTH_FAILED",c[c.HISTORY_SYNC_FAILED=3]="HISTORY_SYNC_FAILED",c[c.AUTH_TIMEOUT=4]="AUTH_TIMEOUT";var d,p,u,_,f,v,E,y="MISSING_PARAMETER",g="DEVELOPER_INVALID",S="UID_BANNED",T="IP_BANNED",m="CHANNEL_BANNED",b="APPID_INVALID",C="SERVER_NOT_OPEN",A="TOKEN_EXPIRED",I="TOKEN_INVALID",D="INVALID_PARAMS",x="INVALID_OPERATION",w="CAN_NOT_GET_GATEWAY_SERVER",B="GATEWAY_SERVER_ERROR",R="NO_LOGIN",O="NETWORK_TIMEOUT",L="NETWORK_RESPONSE_ERROR",P="NETWORK_ERROR";t.EBoardTextStyle=void 0,(d=t.EBoardTextStyle||(t.EBoardTextStyle={}))[d.NORMAL=0]="NORMAL",d[d.BOLD=1]="BOLD",d[d.ITALIC=2]="ITALIC",d[d.BOLD_ITALIC=3]="BOLD_ITALIC",function(t){t.ARROW="Arrow",t.CIRCLE="Circle",t.LASER_POINTER="LaserPointer",t.ELLIPSE="Ellipse",t.RECT="Rect",t.LINE="Line",t.FREE_DRAW="FreeDraw",t.TEXT="Text"}(p||(p={})),function(t){t[t.CONNECT=2e5]="CONNECT",t[t.INIT=3e5]="INIT",t[t.CHAN_DATA=300001]="CHAN_DATA",t[t.ADD_FILE=300002]="ADD_FILE",t[t.DELETE_FILE=300003]="DELETE_FILE",t[t.FILE_LIST=300004]="FILE_LIST",t[t.BRUSH_DATA=300005]="BRUSH_DATA",t[t.CUR_BOARD_DATA=300006]="CUR_BOARD_DATA",t[t.CACHE_BOARD_DATA=300007]="CACHE_BOARD_DATA",t[t.RE_UPLOAD=300008]="RE_UPLOAD",t[t.BOARD_LIST=31e4]="BOARD_LIST",t[t.CHAN_BOARD_LIST=310001]="CHAN_BOARD_LIST",t[t.BOARD_DATA=310002]="BOARD_DATA",t[t.ADD_BOARD=310003]="ADD_BOARD",t[t.SWITCH_BOARD=310004]="SWITCH_BOARD",t[t.DELETE_BOARD=310005]="DELETE_BOARD",t[t.SCALE_BOARD=310006]="SCALE_BOARD",t[t.BOARD_RATIO=310007]="BOARD_RATIO",t[t.RESET_BOARD=310008]="RESET_BOARD",t[t.CLEAR_BOARD=310009]="CLEAR_BOARD",t[t.UPDATE_BACKGROUND=310010]="UPDATE_BACKGROUND",t[t.UPDATE_BACKGROUND_IMAGE=310011]="UPDATE_BACKGROUND_IMAGE",t[t.UPDATE_BACKGROUND_H5=310012]="UPDATE_BACKGROUND_H5",t[t.ADD_SHAPE=32e4]="ADD_SHAPE",t[t.MOVE_SHAPE=320001]="MOVE_SHAPE",t[t.DELETE_SHAPE=320002]="DELETE_SHAPE",t[t.PROCESS_SHAPE=320003]="PROCESS_SHAPE",t[t.INVALID_PARAMS=4e5]="INVALID_PARAMS",t[t.INTERNAL_ERROR=5e5]="INTERNAL_ERROR",t[t.KEEP_A_LIVE=6e5]="KEEP_A_LIVE"}(u||(u={})),function(t){t.ERROR="board-error",t.WARNING="board-warning",t.CONNECTION_STATE_CHANGE="connection-state-change",t.DATA_SYNC_COMPLETED="data-sync-completed",t.ADD_BOARD="add-board",t.DELETE_BOARD="delete-board",t.GOTO_BOARD="goto-board",t.CLEAR_BOARD="clear-board",t.RESET_BOARD="reset-board",t.SCALE_BOARD="board-scale-change",t.RATIO_BOARD="board-ratio-change",t.CAN_UNDO_STATUS_CHANGE="board-can-undo-status",t.CAN_REDO_STATUS_CHANGE="board-can-redo-status",t.BOARD_BACKGROUND_COLOR_CHANGE="board-background-color-change"}(_||(_={})),function(t){t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.NETWORK_ERROR="NETWORK_ERROR",t.KEEP_A_LIVE_TIMEOUT="KEEP_A_LIVE_TIMEOUT",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER"}(f||(f={})),t.EBoardToolType=void 0,(v=t.EBoardToolType||(t.EBoardToolType={}))[v.NONE=0]="NONE",v[v.SELECT=1]="SELECT",v[v.FREE_DRAW=2]="FREE_DRAW",v[v.ERASER=3]="ERASER",v[v.LASER_POINTER=4]="LASER_POINTER",v[v.LINE=5]="LINE",v[v.ARROW=6]="ARROW",v[v.RECT=7]="RECT",v[v.ELLIPSE=8]="ELLIPSE",v[v.TEXT=9]="TEXT",function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SELECTED=1]="SELECTED",t[t.FOCUSED=2]="FOCUSED"}(E||(E={}));var N,M=function(){function t(t,e,o,i,n){void 0===i&&(i=[0,0]),this.id="",this.rectWithStrokePadding=10,this._props={},this._position=[0,0],this._rect={x:0,y:0,width:0,height:0},this._rectWithStroke={x:0,y:0,width:0,height:0},this.style={lineWidth:1,opacity:1,lineDash:[],fillStyle:"",strokeStyle:"#000000"},this.selectState=E.DEFAULT,this.group=0,this.id=t,this.type=e,n&&(this.style=n),this.props=o,this.position=i}return Object.defineProperty(t.prototype,"props",{get:function(){return this._props},set:function(t){this._props=t,this._rect=this._calculateShapeRectBounding(),this._rectWithStroke=this._calculateShapeRectWithStrokeBounding()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this._rect=this._calculateShapeRectBounding(),this._rectWithStroke=this._calculateShapeRectWithStrokeBounding()},enumerable:!1,configurable:!0}),t.prototype.getBoundingRect=function(){return this._rectWithStroke},t.prototype.rectContain=function(t,e){var o=this._rectWithStroke,i=o.x,n=o.y,r=o.width,s=o.height;return t>=i&&t<=i+r&&e>=n&&e<=n+s},t.prototype.isPointInPath=function(t,e){return!1},t.prototype.buildPath=function(t,e){var o=i(i({},this.style),null==e?void 0:e.style),n=o.strokeStyle,r=o.lineWidth,s=o.lineDash,a=o.fillStyle;a&&(t.fillStyle=a),n&&(t.strokeStyle=n),r&&(t.lineWidth=r),s&&t.setLineDash(s)},t.prototype.buildElement=function(t){},t.prototype.attr=function(t,e){"props"===t?this.props=i(i({},this.props),e):"position"===t?this.position=h([],a(e)):"style"===t&&(this.style=i(i({},this.style),e))},t.prototype._calculateShapeRectBounding=function(){return{x:0,y:0,width:0,height:0}},t.prototype._calculateShapeRectWithStrokeBounding=function(){return{x:0,y:0,width:0,height:0}},t}(),k=function(t){function e(e,o){return t.call(this,e,p.ARROW,o.props||{points:[]},o.position||[0,0],o.style||{fillStyle:"transparent",lineWidth:1,strokeStyle:"#000000"})||this}return o(e,t),e.prototype._calculateShapeRectBounding=function(){var t=this._props.points,e=this.position;if(4===(null==t?void 0:t.length)){var o=this.style.lineWidth,i=o/2,n=0,r=0,s=0,a=0;t.forEach((function(t,o){0===o?(n=s=t[0]+e[0],r=a=t[1]+e[1]):(n=t[0]+e[0]<n?t[0]+e[0]:n,r=t[1]+e[1]<r?t[1]+e[1]:r,s=t[0]+e[0]>s?t[0]+e[0]:s,a=t[1]+e[1]>a?t[1]+e[1]:a)}));var h=Math.floor(Math.abs(s-n)),c=Math.floor(Math.abs(a-r));return{x:n-i,y:r-i,width:h+o,height:c+o}}return{x:0,y:0,width:0,height:0}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this._props.points,e=this.position;if(4===(null==t?void 0:t.length)){var o=this.style.lineWidth,i=o/2,n=0,r=0,s=0,a=0;t.forEach((function(t,o){0===o?(n=s=t[0]+e[0],r=a=t[1]+e[1]):(n=t[0]+e[0]<n?t[0]+e[0]:n,r=t[1]+e[1]<r?t[1]+e[1]:r,s=t[0]+e[0]>s?t[0]+e[0]:s,a=t[1]+e[1]>a?t[1]+e[1]:a)}));var h=Math.floor(Math.abs(s-n)),c=Math.floor(Math.abs(a-r));return{x:n-this.rectWithStrokePadding/2-i,y:r-this.rectWithStrokePadding/2-i,width:h+this.rectWithStrokePadding+o,height:c+this.rectWithStrokePadding+o}}return{x:0,y:0,width:0,height:0}},e.prototype.isPointInPath=function(t,e){var o=this._props.points,i=this.position;if(4===(null==o?void 0:o.length)){var n=this.style.lineWidth/2,r=0,s=0,a=0,h=0;return o.forEach((function(t,e){0===e?(r=a=t[0]+i[0],s=h=t[1]+i[1]):(r=(t[0]+i[0]<r?t[0]+i[0]:r)-n,s=(t[1]+i[1]<s?t[1]+i[1]:s)-n,a=(t[0]+i[0]>a?t[0]+i[0]:a)+n,h=(t[1]+i[1]>h?t[1]+i[1]:h)+n)})),t>=r&&t<=a&&e>=s&&e<=h}return!1},e.prototype.buildPath=function(e,o){e.save(),t.prototype.buildPath.call(this,e,o);var n=i(i({},this.props),null==o?void 0:o.props),r=(null==o?void 0:o.position)||this.position;if(n&&n.points&&n.points.length>=4){var s=n.points;e.beginPath(),e.moveTo(s[0][0]+r[0],s[0][1]+r[1]),e.lineTo(s[1][0]+r[0],s[1][1]+r[1]),e.moveTo(s[2][0]+r[0],s[2][1]+r[1]),e.lineTo(s[1][0]+r[0],s[1][1]+r[1]),e.lineTo(s[3][0]+r[0],s[3][1]+r[1]),e.stroke()}e.restore()},e}(M),W=function(t){function e(e,o){return t.call(this,e,p.CIRCLE,o.props||{x1:0,y1:0,x2:0,y2:0},o.position||[0,0],o.style||{fillStyle:"transparent",lineWidth:1,strokeStyle:"#000000"})||this}return o(e,t),e.prototype._calculateShapeRectBounding=function(){var t=this._props,e=t.x1,o=t.x2,i=t.y1,n=t.y2,r=this.style.lineWidth,s=r/2;return{x:(e<o?e:o)-s,y:(i<n?i:n)-s,width:Math.abs(e-o)+r,height:Math.abs(i-n)+r}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this._props,e=t.x1,o=t.x2,i=t.y1,n=t.y2,r=this.style.lineWidth,s=r/2,a=(i<n?i:n)-s;return{x:(e<o?e:o)-s-this.rectWithStrokePadding/2,y:a-this.rectWithStrokePadding/2,width:Math.abs(e-o)+this.rectWithStrokePadding+r,height:Math.abs(i-n)+this.rectWithStrokePadding+r}},e.prototype.isPointInPath=function(t,e){var o=this._props,i=o.x1,n=o.x2,r=o.y1,s=o.y2,a=this.style.lineWidth/2;return t>=(i<n?i:n)-a&&t<=(i<n?n:i)+a&&e>=(r<s?r:s)-a&&e<=(r<s?s:r)+a},e.prototype.buildPath=function(e,o){t.prototype.buildPath.call(this,e,o);var i=o.props,n=o.style;if(n&&n.fillStyle||this.style&&this.style.fillStyle,i){var r=i.x1,s=i.x2,a=i.y1,h=i.y2,c=0,l=0,d=0,p=0;r<s?(c=r,l=a,d=s,p=h):(c=s,l=h,d=r,p=a);var u=Math.abs(d-c),_=Math.abs(p-l),f=u<_?_/2:u/2,v=c+f,E=l+f;e.beginPath(),e.arc(v,E,f,0,360),e.stroke()}},e}(M),U=function(t){function e(e,o){return t.call(this,e,p.ELLIPSE,o.props||{cx:0,cy:0,xr:0,yr:0},o.position||[0,0],o.style||{fillStyle:"transparent",lineWidth:1,strokeStyle:"#000000"})||this}return o(e,t),e.prototype._calculateShapeRectBounding=function(){var t=this._props,e=t.cx,o=t.cy,i=t.xr,n=t.yr,r=this.position,s=this.style.lineWidth/2;return{x:Math.floor(e-i)+r[0]-s,y:Math.floor(o-n)+r[1]-s,width:2*i+s,height:2*n+s}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this._props,e=t.cx,o=t.cy,i=t.xr,n=t.yr,r=this.position,s=this.style.lineWidth,a=s/2,h=Math.floor(e-i)+r[0]-a,c=Math.floor(o-n)+r[1]-a;return{x:h-this.rectWithStrokePadding/2,y:c-this.rectWithStrokePadding/2,width:2*i+this.rectWithStrokePadding+s,height:2*n+this.rectWithStrokePadding+s}},e.prototype.isPointInPath=function(t,e){var o=this._props,i=o.cx,n=o.cy,r=o.xr,s=o.yr,a=this.position,h=this.style.lineWidth/2,c=Math.floor(i-r)+a[0]-h,l=Math.floor(n-s)+a[1]-h,d=Math.floor(i+r)+a[0]+h,p=Math.floor(n+s)+a[1]+h;return t>=c&&t<=d&&e>=l&&e<=p},e.prototype.buildPath=function(e,o){e.save(),t.prototype.buildPath.call(this,e,o);var n=i(i({},this.props),null==o?void 0:o.props),r=(null==o?void 0:o.position)||this.position;if(n){var s=n.cx,a=n.cy,h=n.xr,c=n.yr;e.beginPath(),e.ellipse(s+r[0],a+r[1],h,c,0,0,360),e.stroke()}e.restore()},e}(M),G=function(t){function e(e,o){return t.call(this,e,p.FREE_DRAW,o.props||{points:[]},o.position||[0,0],o.style||{lineWidth:1,strokeStyle:"#000000"})||this}return o(e,t),e.prototype._calculateShapeRectBounding=function(){var t=this.props.points,e=this.position;if(t&&t.length>1){var o=0,i=0,n=0,r=0;t.forEach((function(t,s){0===s?(o=n=t[0]+e[0],i=r=t[1]+e[1]):(o=t[0]+e[0]<o?t[0]+e[0]:o,i=t[1]+e[1]<i?t[1]+e[1]:i,n=t[0]+e[0]>n?t[0]+e[0]:n,r=t[1]+e[1]>r?t[1]+e[1]:r)}));var s=this.style.lineWidth,a=s/2,h=Math.floor(Math.abs(n-o))+s,c=Math.floor(Math.abs(r-i))+s;return{x:o-a,y:i-a,width:h,height:c}}return{x:0,y:0,width:0,height:0}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this.props.points,e=this.position;if(t&&t.length>1){var o=0,i=0,n=0,r=0;t.forEach((function(t,s){0===s?(o=n=t[0]+e[0],i=r=t[1]+e[1]):(o=t[0]+e[0]<o?t[0]+e[0]:o,i=t[1]+e[1]<i?t[1]+e[1]:i,n=t[0]+e[0]>n?t[0]+e[0]:n,r=t[1]+e[1]>r?t[1]+e[1]:r)}));var s=this.style.lineWidth,a=s/2,h=Math.floor(Math.abs(n-o))+s,c=Math.floor(Math.abs(r-i))+s;return{x:o-a-this.rectWithStrokePadding/2,y:i-a-this.rectWithStrokePadding/2,width:h+this.rectWithStrokePadding,height:c+this.rectWithStrokePadding}}return{x:0,y:0,width:0,height:0}},e.prototype.isPointInPath=function(t,e){var o=this.props.points,i=this.position;if(o&&o.length>1){var n=this.style.lineWidth/2,r=0,s=0,a=0,h=0;return o.forEach((function(t,e){0===e?(r=a=t[0]+i[0],s=h=t[1]+i[1]):(r=(t[0]+i[0]<r?t[0]+i[0]:r)-n,s=(t[1]+i[1]<s?t[1]+i[1]:s)-n,a=(t[0]+i[0]>a?t[0]+i[0]:a)+n,h=(t[1]+i[1]>h?t[1]+i[1]:h)+n)})),t>=r&&t<=a&&e>=s&&e<=h}return!1},e.prototype.buildPath=function(e,o){e.save(),t.prototype.buildPath.call(this,e,o);var n=i(i({},this.props),null==o?void 0:o.props),r=(null==o?void 0:o.position)||this.position;if(n){var s=n.points,a=r[0],h=r[1];if(!s)return;if(s.length>2){e.lineCap="round",e.lineJoin="round",e.beginPath();for(var c=0;c<s.length-1;c++)if(0===c)e.moveTo(s[0][0]+a,s[0][1]+h);else if(c===s.length-2)e.lineTo(s[c-1][0]+a,s[c-1][1]+h),e.stroke();else{if(c===s.length-1)return;var l=s[c+1],d=(l[0]+s[c+2][0])/2+a,p=(l[1]+s[c+2][1])/2+h;e.quadraticCurveTo(l[0]+a,l[1]+h,d,p)}}}e.restore()},e}(M),H=function(t,e){void 0===e&&(e={});var o=t.kind,n=t.key,r=t.props,s=t.style,a=t.children,h=document.createElement(o);return n&&(e[n]=h),r&&Object.keys(r).forEach((function(t){h.setAttribute(t,r[t])})),s&&Object.keys(s).forEach((function(t){h.style.setProperty(t,s[t])})),a&&a.forEach((function(t){var o=H(t,e);t.key&&(e[t.key]=o.el),h.append(o.el)})),i(i({},e),{el:h})},F=function(t){function e(e,o){var i=t.call(this,e,p.LASER_POINTER,o.props||{cx:0,cy:0,r:0},o.position||[0,0],o.style||{fillStyle:"transparent",lineWidth:1,strokeStyle:"#000000"})||this;i.touchId=0;var n=H({kind:"div",props:{"data-uid":e,class:"board-laser_item"},style:{position:"absolute",left:"0",top:"0",width:"32px",height:"32px","z-index":"40","will-change":"transform","pointer-events":"none",transform:"translate("+(i.props.cx+i.position[0]||0)+"px, "+(i.props.cy+i.position[1]||0)+"px) scale(1.0)"},children:[{kind:"img",props:{src:"data:image/svg+xml,%3c%3fxml version='1.0' encoding='UTF-8'%3f%3e%3csvg width='32px' height='32px' viewBox='0 0 32 32' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e %3ctitle%3elaser-pointer%3c/title%3e %3cdefs%3e %3cradialGradient cx='50%25' cy='50%25' fx='50%25' fy='50%25' r='50%25' id='radialGradient-1'%3e %3cstop stop-color='%23FF001C' offset='0%25'%3e%3c/stop%3e %3cstop stop-color='%23FF001C' stop-opacity='0' offset='100%25'%3e%3c/stop%3e %3c/radialGradient%3e %3c/defs%3e %3cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3e %3cg transform='translate(-2.000000%2c -2.000000)'%3e %3ccircle fill='url(%23radialGradient-1)' cx='18' cy='18' r='12'%3e%3c/circle%3e %3ccircle stroke='white' fill='%23FF001C' cx='18' cy='18' r='2.5'%3e%3c/circle%3e %3c/g%3e %3c/g%3e%3c/svg%3e"},style:{display:"block","pointer-events":"none",position:"absolute",transform:"translate(-50%, -50%)"}}]}).el;return i.el=n,i}return o(e,t),e.prototype._getTextBounding=function(){var t,e;return{width:(null===(t=this.el)||void 0===t?void 0:t.offsetWidth)||0,height:(null===(e=this.el)||void 0===e?void 0:e.offsetHeight)||0}},e.prototype._calculateShapeRectBounding=function(){var t=this._props,e=t.x,o=t.y,i=this.position,n=this._getTextBounding(),r=n.width,s=n.height;return{x:e+i[0],y:o+i[1],width:r,height:s}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this._props,e=t.x,o=t.y,i=this.position,n=this._getTextBounding(),r=n.width,s=n.height;return{x:e+i[0]-this.rectWithStrokePadding/2,y:o+i[1]-this.rectWithStrokePadding/2,width:r+this.rectWithStrokePadding,height:s+this.rectWithStrokePadding}},e.prototype.isPointInPath=function(t,e){var o=this._props,i=o.cx,n=o.cy,r=this.position,s=this._getTextBounding(),a=s.width,h=s.height,c=i+r[0],l=n+r[1];return t>=c&&t<=c+a&&e>=l&&e<=l+h},e.prototype.buildPath=function(t,e){},e.prototype.addPosition=function(t,e){this.position[0]+=t,this.position[1]+=e,this.setPosition(this.position[0],this.position[1])},e.prototype.setPosition=function(t,e){var o=this;this.el&&(this.position=[t,e],document.querySelectorAll(".board-laser_item").forEach((function(i){i.getAttribute("data-uid")===o.id&&(o.el=i,o.el.style.transform="translate("+(o.props.cx+t)+"px, "+(o.props.cy+e)+"px) scale(1.0)")})))},e.prototype.buildElement=function(t){var e;t instanceof HTMLElement?t.appendChild(this.el):"string"==typeof t&&(null===(e=document.querySelector("#"+t))||void 0===e||e.appendChild(this.el))},e.prototype.dispose=function(){var t;null===(t=this.el)||void 0===t||t.remove()},e}(M),K=function(t){function e(e,o){return t.call(this,e,p.LINE,o.props||{x:0,y:0,x1:0,y1:0},o.position||[0,0],o.style||{fillStyle:"transparent",lineWidth:1,strokeStyle:"#000000"})||this}return o(e,t),e.prototype._calculateShapeRectBounding=function(){var t=this._props,e=t.x,o=t.y,i=t.x1,n=t.y1,r=this.position,s=this.style.lineWidth,a=s/2,h=(o<n?o:n)-a;return{x:(e<i?e:i)-a+r[0],y:h+r[1],width:Math.floor(Math.abs(i-e))+s,height:Math.floor(Math.abs(n-o))+s}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this._props,e=t.x,o=t.y,i=t.x1,n=t.y1,r=this.position,s=this.style.lineWidth,a=s/2,h=(o<n?o:n)-a;return{x:(e<i?e:i)-a+r[0]-this.rectWithStrokePadding/2,y:h+r[1]-this.rectWithStrokePadding/2,width:Math.floor(Math.abs(i-e))+this.rectWithStrokePadding+s,height:Math.floor(Math.abs(n-o))+this.rectWithStrokePadding+s}},e.prototype.isPointInPath=function(t,e){var o=this._props,i=o.x,n=o.y,r=o.x1,s=o.y1,a=this.position,h=this.style.lineWidth/2,c=(i<r?i:r)+a[0]-h,l=(n<s?n:s)+a[1]-h,d=(i<r?r:i)+a[0]+h,p=(n<s?s:n)+a[1]+h;return t>=c&&t<=d&&e>=l&&e<=p},e.prototype.buildPath=function(e,o){e.save(),t.prototype.buildPath.call(this,e,o);var n=i(i({},this.props),null==o?void 0:o.props),r=(null==o?void 0:o.position)||this.position;if(n){var s=n.x,a=n.y,h=n.x1,c=n.y1;e.beginPath(),e.moveTo(s+r[0],a+r[1]),e.lineTo(h+r[0],c+r[1]),e.stroke()}e.restore()},e}(M),z=function(t){function e(e,o){return t.call(this,e,p.RECT,i({x1:0,y1:0,x2:0,y2:0},o.props),o.position||[0,0],i({fillStyle:"transparent",lineWidth:1,strokeStyle:"#000000"},o.style))||this}return o(e,t),e.prototype._calculateShapeRectBounding=function(){var t=this._props,e=t.x1,o=t.y1,i=t.x2,n=t.y2,r=this.position,s=this.style.lineWidth,a=s/2,h=e<i?e:i-a,c=o<n?o:n-a,l=Math.abs(i-e)+s,d=Math.abs(n-o)+s;return{x:h+r[0],y:c+r[1],width:l+s,height:d+s}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this._props,e=t.x1,o=t.y1,i=t.x2,n=t.y2,r=this.position,s=this.style.lineWidth,a=s/2,h=(e<i?e:i)-a,c=(o<n?o:n)-a,l=Math.abs(i-e)+s,d=Math.abs(n-o)+s;return{x:h+r[0]-this.rectWithStrokePadding/2,y:c+r[1]-this.rectWithStrokePadding/2,width:l+this.rectWithStrokePadding,height:d+this.rectWithStrokePadding}},e.prototype.isPointInPath=function(t,e){var o=this._props,i=o.x1,n=o.y1,r=o.x2,s=o.y2,a=this.position,h=this.style.lineWidth/2,c=(i<r?i:r)+a[0]-h,l=(n<s?n:s)+a[1]-h,d=(i<r?r:i)+a[0]+h,p=(n<s?s:n)+a[1]+h;return t>=c&&t<=d&&e>=l&&e<=p},e.prototype.buildPath=function(e,o){e.save(),t.prototype.buildPath.call(this,e,o);var n=i(i({},this.props),null==o?void 0:o.props),r=(null==o?void 0:o.position)||this.position;if(n){var s=n.x1,a=n.y1,h=n.x2,c=n.y2,l=(s<h?s:h)+r[0],d=(a<c?a:c)+r[1];e.beginPath(),e.rect(l,d,Math.abs(h-s),Math.abs(c-a)),e.stroke()}e.restore()},e}(M),q=document.createElement("canvas").getContext("2d"),V=function(t,e,o){var i=t.replace(/\n|\r/gi,"<br />").split("<br />"),n=[],r=0;return i.forEach((function(t,i){var s=Y(t,e,o),c=s.width,l=s.list;r<c&&(r=c),n.push.apply(n,h([],a(l)))})),{width:r,height:n.length*e.lineHeight,list:n}},Y=function(t,e,o){var i=0,n=[],r=e.fontStyle,s=e.fontWeight,a=e.fontSize,h=e.fontFamily,c=e.lineHeight;if(q.font=r+" "+s+" "+a+"px/"+c+"px "+h,q.measureText(t).width<=o){var l=Math.ceil(q.measureText(t).width);n.push({text:t,width:l}),i=l>a?l:a}else for(var d="",p=0,u=0;u<t.length;u++){d+=t[u];var _=q.measureText(d).width;if(_===o){l=Math.ceil(q.measureText(t.substring(p,u+1)).width);n.push({text:t.substring(p,u+1),width:l}),i<l&&(i=l),p=u+1,d=""}else if(_>o){l=Math.ceil(q.measureText(t.substring(p,u)).width);n.push({text:t.substring(p,u),width:l}),i<l&&(i=l),p=u;var f=t.substring(p),v=Math.ceil(q.measureText(f).width);if(v<=o){n.push({text:f,width:v}),i<v&&(i=v);break}d=t[u]}else if(u===t.length-1){l=Math.ceil(q.measureText(t.substring(p)).width);n.push({text:t.substring(p),width:l}),i<l&&(i=l)}}return{list:n,width:i}},j=function(t){function e(e,o){return t.call(this,e,p.TEXT,i({text:"",x:0,y:0,width:0,height:0,maxWidth:0,maxHeight:0,fontSize:12,lineHeight:12},o.props),o.position||[0,0],i({fillStyle:"transparent",lineWidth:1,strokeStyle:"#000000",textFill:"#000000",textStroke:"#000000",fontFamily:"customFontFamily, sans-serif, serif, monospace"},o.style))||this}return o(e,t),e.prototype._getTextBounding=function(){var t=H({kind:"canvas"}).el.getContext("2d"),e=this._props,o=e.text,i=e.fontSize,n=e.lineHeight,r=this.style;r.lineWidth;var s=r.textStyle,a=r.textWeight,h=r.textFill,c=r.textStroke,l=r.fontFamily;if(c&&(t.strokeStyle=c),h&&(t.fillStyle=h),i&&(t.font=s+" "+a+" "+i+"px "+l),o){var d=V(o,{fontSize:i,lineHeight:n,fontFamily:l},this.props.maxWidth),p=d.width,u=d.height;return d.list,{width:p,height:u}}return{width:0,height:i||0}},e.prototype._calculateShapeRectBounding=function(){var t=this._props,e=t.x,o=t.y,i=this.position,n=this._getTextBounding(),r=n.width,s=n.height;return{x:e+i[0],y:o+i[1],width:r,height:s}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this._props,e=t.x,o=t.y,i=this.position,n=this._getTextBounding(),r=n.width,s=n.height;return{x:e+i[0]-this.rectWithStrokePadding/2,y:o+i[1]-this.rectWithStrokePadding/2,width:r+this.rectWithStrokePadding,height:s+this.rectWithStrokePadding}},e.prototype.isPointInPath=function(t,e){var o=this._props,i=o.x,n=o.y,r=this.position,s=this._getTextBounding(),a=s.width,h=s.height,c=i+r[0],l=n+r[1];return t>=c&&t<=c+a&&e>=l&&e<=l+h},e.prototype.setFontSize=function(t){this.style.fontSize=t,this._calculateShapeRectBounding(),this._calculateShapeRectWithStrokeBounding()},e.prototype.buildPath=function(e,o){t.prototype.buildPath.call(this,e,o);var n=i(i({},this.props),null==o?void 0:o.props);if((null==o?void 0:o.position)||this.position,n&&n.text){e.save();var r=n.text,s=n.fontSize,a=n.lineHeight,h=n.maxWidth,c=this._rect,l=c.x,d=c.y,p=c.width,u=c.height,_=i(i({},this.style),null==o?void 0:o.style),f=_.textStyle,v=_.textWeight,E=_.textFill,y=_.textStroke,g=_.fontFamily;y&&(e.fillStyle=y),E&&(e.fillStyle=E),s&&(e.font=f+" "+v+" "+s+"px "+g),e.beginPath(),e.rect(l,d,p,u);var S=V(r,{fontSize:s,lineHeight:a,fontStyle:f,fontWeight:v,fontFamily:g},h);S.width,S.height,S.list.forEach((function(t,o){e.fillText(t.text,l,d+(o+1)*a)})),e.restore()}},e}(M),J=function(t,e){var o="YYYY-MM-DD hh:mm:ss";if("number"!=typeof t)throw new Error("[timesToDate]: timestamp must be number");e&&"string"==typeof e&&(o=e);var i=t||Date.now(),n=new Date(i)||new Date(i),r=n.getFullYear(),s=n.getMonth()+1,a=n.getDate(),h=n.getHours(),c=n.getMinutes(),l=n.getSeconds(),d=n.getMilliseconds();return o.indexOf("YYYY")>-1&&(o=o.replace("YYYY",(function(t){return""+r}))),o.indexOf("MM")>-1?o=o.replace("MM",(function(t){return s<10?"0"+s:""+s})):o.indexOf("M")>-1&&(o=o.replace("M",(function(t){return""+s}))),o.indexOf("DD")>-1?o=o.replace("DD",(function(t){return a<10?"0"+a:""+a})):o.indexOf("D")>-1&&(o=o.replace("D",(function(t){return""+a}))),o.indexOf("hh")>-1?o=o.replace("hh",(function(t){return h<10?"0"+h:""+h})):o.indexOf("h")>-1&&(o=o.replace("h",(function(t){return""+h}))),o.indexOf("mm")>-1?o=o.replace("mm",(function(t){return c<10?"0"+c:""+c})):o.indexOf("m")>-1&&(o=o.replace("m",(function(t){return""+c}))),o.indexOf("ss")>-1?o=o.replace("ss",(function(t){return l<10?"0"+l:""+l})):o.indexOf("s")>-1&&(o=o.replace("s",(function(t){return""+l}))),o.indexOf("ms")>-1&&(o=o.replace("ms",(function(){return""+d}))),o.indexOf("AP")>-1&&(o=o.replace("AP",(function(){return h>12?"PM":"AM"}))),o},X=function(t,e){return Math.round(Number(t+"e"+e))/Math.pow(10,e)},Q=function(t,e){var o=a(t,4),i=o[0],n=o[1],r=o[2],s=o[3],h=e||30,c=180*Math.atan2(n-s,i-r)/Math.PI,l=(c+30)*Math.PI/180,d=(c-30)*Math.PI/180;return[[i,n],[r,s],[r+h*Math.cos(l),s+h*Math.sin(l)],[r+h*Math.cos(d),s+h*Math.sin(d)]]},Z=function(t){void 0===t&&(t=13),t>20&&(t=20);var e=Math.ceil(Math.random()*Math.pow(10,t));return e<Math.pow(10,t-1)?Z(t):e};!function(t){t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARNING=2]="WARNING",t[t.ERROR=3]="ERROR",t[t.NONE=4]="NONE"}(N||(N={}));var $=function(){function t(){this.logPrefix="SupLogger",this.logLevel=N.NONE,this.uploadServeTranslators=[],this.DEBUG=N.DEBUG,this.INFO=N.INFO,this.WARNING=N.WARNING,this.ERROR=N.ERROR,this.NONE=N.NONE}return t.prototype.setLogLevel=function(t,e){e&&(this.logPrefix=e),"number"==typeof t&&t>-1&&t<5&&(this.logLevel=t)},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!(this.logLevel>N.ERROR&&this.logLevel!==N.NONE||this.logLevel===N.NONE)){var o=t,i=Date.now();o.unshift("["+J(i,"hh:mm:ss:ms")+"] %c"+this.logPrefix+" [ERROR]:%c","color: #b00020; font-weight: bold;","color: #dc3545;"),this.uploadServeTranslators.length>0?this.uploadServeTranslators.map((function(t){t({type:"error",params:o,timestamp:i},(function(){console.error.apply(console,o)}))})):console.error.apply(console,o)}},t.prototype.warning=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!(this.logLevel>N.WARNING&&this.logLevel!==N.NONE||this.logLevel===N.NONE)){var o=t,i=Date.now();o.unshift("["+J(i,"hh:mm:ss:ms")+"] %c"+this.logPrefix+" [WARNING]:","color: #ffc107; font-weight: bold;"),this.uploadServeTranslators.length>0?this.uploadServeTranslators.map((function(t){t({type:"warning",params:o,timestamp:i},(function(){console.warn.apply(console,o)}))})):console.warn.apply(console,o)}},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!(this.logLevel>N.INFO&&this.logLevel!==N.NONE||this.logLevel===N.NONE)){var o=t,i=Date.now();o.unshift("["+J(i,"hh:mm:ss:ms")+"] %c"+this.logPrefix+" [INFO]:","color:  #007bff; font-weight: bold;"),this.uploadServeTranslators.length>0?this.uploadServeTranslators.map((function(t){t({type:"info",params:o,timestamp:i},(function(){console.log.apply(console,o)}))})):console.log.apply(console,o)}},t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!(this.logLevel>N.DEBUG&&this.logLevel!==N.NONE||this.logLevel===N.NONE)){var o=t,i=Date.now();o.unshift("["+J(i,"hh:mm:ss.ms")+"] %c"+this.logPrefix+" [DEBUG]:","color:#6facff;"),this.uploadServeTranslators.length>0?this.uploadServeTranslators.map((function(t){t({type:"debug",params:o,timestamp:i},(function(){console.log.apply(console,o)}))})):console.log.apply(console,o)}},t}(),tt=new $;tt.setLogLevel(tt.DEBUG,"ar-whiteboard");var et,ot=Array.prototype,it=function(){function t(){this._events={},this.addListener=this.on}return t.prototype.getListeners=function(t){return this._events[t]?ot.map.call(this._events[t],(function(t){return t.listener})):[]},t.prototype.on=function(t,e){this._events[t]||(this._events[t]=[]);var o=this._events[t];-1===this._indexOfListener(o,e)&&o.push({listener:e,once:!1})},t.prototype.once=function(t,e){this._events[t]||(this._events[t]=[]);var o=this._events[t];-1===this._indexOfListener(o,e)&&o.push({listener:e,once:!0})},t.prototype.off=function(t,e){this._events[t]||(this._events[t]=[]);var o=this._events[t],i=this._indexOfListener(o,e);-1!==i&&ot.splice.call(o,i,1)},t.prototype.removeAllListeners=function(t){t?delete this._events[t]:this._events={}},t.prototype.emit=function(t){for(var e,o,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];this._events[t]||(this._events[t]=[]);var r=this._events[t];try{for(var a=s(r),h=a.next();!h.done;h=a.next()){var c=h.value;c.once&&this.off(t,c.listener),c.listener.apply(this,i||[])}}catch(t){e={error:t}}finally{try{h&&!h.done&&(o=a.return)&&o.call(a)}finally{if(e)throw e.error}}},t.prototype._indexOfListener=function(t,e){for(var o=t.length;o--;)if(t[o].listener===e)return o;return-1},t}(),nt=function(){function t(t,e,o){void 0===e&&(e=""),this.name="ArWhiteBoardException",this.code=t;var i="ArWhiteBoardError".concat(" ").concat(this.code,": ");this.message=e?i.concat(e):i,this.data=o}return t.prototype.toString=function(){return this.data?"".concat(this.message," data: ").concat(JSON.stringify(this.data)):this.message},t}(),rt=function(){var t,e,o=navigator.userAgent;try{for(var i=s(["Android","iPhone","SymbianOS","Windows Phone","iPod","iPad"]),n=i.next();!n.done;n=i.next()){var r=n.value;if(o.indexOf(r)>=0)return!0}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return!1},st=function(t){function e(e,o){var n,r=t.call(this)||this;if(r.options={width:1920,height:1080,globalBackgroundColor:"#ffffff",backgroundImage:"",ratio:"16:9",scale:100},r._boxWidth=0,r._boxHeight=0,r._width=0,r._height=0,r._controlBoxPosition=[0,0,0,0],r.selectStartPosition=[],r.selectLatestMovePosition=[],r._handleMouseDown=function(){},r._handleMouseMove=function(){},r._handleMouseUp=function(){},r._handleControlBoxMouseDown=function(){},r._handleControlBoxMouseMove=function(){},r._handleControlBoxMouseUp=function(){},e instanceof HTMLElement)n=e;else{if("string"!=typeof e||!document.querySelector("#"+e))throw new nt(D,"selector must be HTMLElement or Element id");n=document.querySelector("#"+e)}return r._rootDom=n,r.options=i(i(i({},r.options),o),{width:r._rootDom.clientWidth,height:r._rootDom.clientHeight}),r._calculateCanvasWidthAndHeight(),r.init(),r}return o(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boxWidth",{get:function(){return this._boxWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boxHeight",{get:function(){return this._boxHeight},enumerable:!1,configurable:!0}),e.prototype.getRetinaScaling=function(){return window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio||1},e.prototype.init=function(){var t=H({key:"canvasBox",kind:"div",props:{class:"board_wrap"},style:{position:"relative",width:this._boxWidth+"px",height:this._boxHeight+"px",top:this._rootDom.offsetHeight/2+"px",left:this._rootDom.offsetWidth/2+"px",transform:"translate(-50%, -50%)",padding:"0px",margin:"0px","border-width":"0px",overflow:"hidden"},children:[{key:"cacheCanvas",kind:"canvas",props:{class:"board-cache_canvas",width:this._width,height:this._height},style:{position:"absolute",left:"0px",top:"0px",width:this._width+"px",height:this._height+"px",userSelect:"none",padding:"0px","margin-top":"0px","margin-left":"0px",borderWidth:"0px","z-index":10,PointerEvent:"none"},children:[]},{key:"canvas",kind:"canvas",props:{class:"board_canvas",width:this._width,height:this._height},style:{position:"absolute",left:"0px",top:"0px",width:this._width+"px",height:this._height+"px",userSelect:"none",padding:"0px","margin-top":"0px","margin-left":"0px",borderWidth:"0px","z-index":10},children:[]},{key:"canvasBackgroundImage",kind:"img",props:{class:"board_background_image"},style:{position:"absolute",left:"0px",top:"0px",visibility:"hidden","z-index":5},children:[]},{key:"canvasBackground",kind:"div",props:{class:"board_background_wrap",width:"100%",height:"100%"},style:{position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",padding:"0px",margin:"0px","z-index":4,"background-color":this.options.globalBackgroundColor},children:[]},{key:"cursorWrap",kind:"div",props:{class:"cursor_wrap_view",width:"100%",height:"100%"},style:{position:"absolute",left:"50%",top:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",border:"none","z-index":11,"pointer-events":"none"},children:[]},{key:"controlWrap",kind:"div",props:{class:"control_wrap_view",width:"100%",height:"100%"},style:{position:"absolute",display:"none",left:"50%",top:"50%",width:"100%",height:"100%",border:"none","user-select":"none",transform:"translate(-50%, -50%)","z-index":0},children:[{key:"controlBox",kind:"div",style:{position:"absolute",border:"1px dashed "+this.options.selectBoxColor,cursor:"move",visibility:"visible",transform:"translateX(0px) translateY(0px) rotate(0deg)"},children:[]}]},{key:"loading",kind:"img",props:{class:"board_loading",src:this.options.progressBarUrl},style:{position:"absolute",display:"none",left:"50%",top:"50%",transform:"translate(-50%, -50%)",overflow:"hidden","z-index":200},children:[]},{key:"textBox",kind:"div",props:{class:"board_text_box",width:"100%",height:"100%"},style:{position:"absolute",left:"50%",top:"50%",width:"100%",height:"100%",border:"none",transform:"translate(-50%, -50%)","z-index":9,overflow:"hidden"},children:[{key:"textInput",kind:"textarea",props:i({class:"board-text_input"},l.TEXT_INPUT_ELEMENT_OPTIONS.props),style:i(i({},l.TEXT_INPUT_ELEMENT_OPTIONS.style),{visibility:"hidden"})}]},{key:"canvasH5",kind:"iframe",props:{class:"board_webview",width:"100%",height:"100%"},style:{position:"absolute",left:"0",top:"0",width:"100%",height:"100%",border:"none","z-index":8},children:[]}]}),e=t.el,o=t.canvasBox,n=t.canvas,r=t.cacheCanvas,s=t.canvasBackground,a=t.canvasBackgroundImage,h=t.textBox;t.textInput;var c=t.cursorWrap,d=t.loading,p=t.controlWrap,u=t.controlBox;this._rootDom.appendChild(e),this._canvasBox=o,this._canvas=n,this._cacheCanvas=r,this._canvasBgWrap=s,this._canvasBgImg=a,this._cursorWrap=c,this._loading=d,this._textBox=h,this._controlWrap=p,this._controlBox=u,this._canvasCtx=n.getContext("2d"),this._cacheCanvasCtx=r.getContext("2d"),this._handleControlBoxMouseDown=this.handleControlBoxMouseDown.bind(this),this._handleControlBoxMouseMove=this.handleControlBoxMouseMove.bind(this),this._handleControlBoxMouseUp=this.handleControlBoxMouseUp.bind(this),this._controlWrap.ontouchstart=this._controlWrap.onmousedown=this._handleControlBoxMouseDown,this._controlWrap.ontouchmove=this._controlWrap.onmousemove=this._handleControlBoxMouseMove,this._controlWrap.ontouchend=this._controlWrap.onmouseup=this._controlWrap.onmouseout=this._handleControlBoxMouseUp,this._canvas.oncontextmenu=function(t){t.preventDefault(),t.stopPropagation()},this.startHandleMoveEvent()},e.prototype.destroy=function(){this._rootDom.innerHTML=""},e.prototype.getSnapShortImage=function(){var t=H({kind:"canvas",props:{width:this.width,height:this.height},style:{}}).el,e=t.getContext("2d");return e.fillStyle=this.options.backgroundColor,e.fillRect(0,0,this.width,this.height),e.drawImage(this._cacheCanvas,0,0),t.toDataURL("image/png")},e.prototype.appendChild=function(t){this._canvasBox.appendChild(t)},e.prototype.setCanvasBGColor=function(t){this.options.backgroundColor=t,this._canvasBgWrap.style.backgroundColor=t},e.prototype.setCanvasBGImage=function(t){t?(this._canvasBgImg.src=t,this._canvasBgImg.style.visibility="visible"):(this._canvasBgImg.removeAttribute("src"),this._canvasBgImg.style.visibility="hidden")},e.prototype.createTextInput=function(t){this._textBox.appendChild(t)},e.prototype.showControlWrap=function(){this._controlWrap.style.display="block",this._controlWrap.style.zIndex="100"},e.prototype.hideControlWrap=function(){this._controlWrap.style.display="block",this._controlWrap.style.zIndex="0"},e.prototype.setControlBoxSize=function(t){var e=t[0],o=t[1],i=t[2],n=t[3];this._controlBox.style.width=i-e+"px",this._controlBox.style.height=n-o+"px",this.setControlBoxPosition(t)},e.prototype.setControlBoxPosition=function(t){var e=(this.boxWidth-this.width)/2,o=(this.boxHeight-this.height)/2,i=t[0]+e,n=t[1]+o;this._controlBoxPosition=t,this._controlBox.style.transform="translateX("+i+"px) translateY("+n+"px) rotate(0deg)"},e.prototype.showLoading=function(){this._loading.style.display="block"},e.prototype.hideLoading=function(){this._loading.style.display="none"},e.prototype.renderSize=function(){this._calculateCanvasWidthAndHeight(),this._canvasBox.style.width=this._boxWidth+"px",this._canvasBox.style.height=this._boxHeight+"px",this._canvasBox.style.top=this._rootDom.offsetHeight/2+"px",this._canvasBox.style.left=this._rootDom.offsetWidth/2+"px",this._canvas.width=this._cacheCanvas.width=this._width,this._canvas.height=this._cacheCanvas.height=this._height,this._canvas.style.width=this._cacheCanvas.style.width=this._width+"px",this._canvas.style.height=this._cacheCanvas.style.height=this._height+"px",this._boxWidth>this._width?(this._canvas.style.marginTop=this._cacheCanvas.style.marginTop=(this._boxHeight-this._height)/2+"px",this._canvas.style.marginLeft=this._cacheCanvas.style.marginLeft=(this._boxWidth-this._width)/2+"px"):(this._canvas.style.marginTop=this._cacheCanvas.style.marginTop="0px",this._canvas.style.marginLeft=this._cacheCanvas.style.marginLeft="0px")},e.prototype.startHandleMoveEvent=function(){this._handleMouseDown=this.handleMouseDown.bind(this),this._handleMouseMove=this.handleMouseMove.bind(this),this._handleMouseUp=this.handleMouseUp.bind(this),rt()?(this._canvas.addEventListener("touchstart",this._handleMouseDown,!1),this._canvas.addEventListener("touchmove",this._handleMouseMove,!1),this._canvas.addEventListener("touchend",this._handleMouseUp,!1),this._canvas.addEventListener("touchcancel",this._handleMouseUp,!1)):(this._canvas.addEventListener("mouseenter",this._handleMouseDown,!1),this._canvas.addEventListener("mousedown",this._handleMouseDown,!1),this._canvas.addEventListener("mousemove",this._handleMouseMove,!1),this._canvas.addEventListener("mouseup",this._handleMouseUp,!1),this._canvas.addEventListener("mouseout",this._handleMouseUp,!1))},e.prototype.stopHandleMoveEvent=function(){rt()?(this._canvas.removeEventListener("touchstart",this._handleMouseDown,!1),this._canvas.removeEventListener("touchmove",this._handleMouseMove,!1),this._canvas.removeEventListener("touchend",this._handleMouseUp,!1),this._canvas.removeEventListener("touchcancel",this._handleMouseUp,!1)):(this._canvas.removeEventListener("mousedown",this._handleMouseDown,!1),this._canvas.removeEventListener("mousemove",this._handleMouseMove,!1),this._canvas.removeEventListener("mouseup",this._handleMouseUp,!1),this._canvas.removeEventListener("mouseout",this._handleMouseUp,!1))},e.prototype._calculateCanvasWidthAndHeight=function(){var t=this.options,e=t.ratio,o=t.scale,i=a(e.split(":"),2),n=i[0],r=i[1],s=this._rootDom.offsetWidth,h=this._rootDom.offsetHeight,c=0;c=s*r/n<h?s:h*n/r,this._boxWidth=c*(o/100),this._boxHeight=this._boxWidth*r/n;var l=window.screen.width,d=0,p=0,u=this._boxWidth<l?this._boxWidth:l,_=u*r/n;d=u,p=_,_>h&&(d=h*n/r,p=h),this._width=d,this._height=p},e.prototype.handleMouseDown=function(t){},e.prototype.handleMouseMove=function(t){},e.prototype.handleMouseUp=function(t){},e.prototype.handleMouseOut=function(t){},e.prototype.handleControlBoxMouseDown=function(t){},e.prototype.handleControlBoxMouseMove=function(t){},e.prototype.handleControlBoxMouseUp=function(t){},e.prototype.handleControlBoxMouseOut=function(t){},e.basicWidth=1920,e.basicHeight=1080,e}(it),at={Arrow:k,Circle:W,Ellipse:U,FreeDraw:G,LaserPointer:F,Line:K,Rect:z,Text:j},ht=2e3,ct=function(e){function n(o,i){var n=e.call(this,o,i)||this;if(n._id="",n.uid="",n._enabled=!0,n._toolType=t.EBoardToolType.NONE,n._brushColor="#000000",n._brushThin=5,n._textStyle="normal",n._textWeight="normal",n._textSize=16,n._textColor="#333333",n._selectBoxColor="#ababab",n._brushCursor="default",n._selectShapes=[],n._laserPointer=null,n._textInput=null,n._temporaryList=new Map,n._displayList=new Map,n._canRedoList=[],n._canUndoList=[],n._mouseDown=!1,n._startPosition=[0,0],n._endPosition=[0,0],n._latestMovePosition=[],n._currentShape=null,n._selectShape=null,n._needUpdateShapeData=null,i){var r=i.brushColor,s=i.brushThin;i.scale;var a=i.textStyle,h=i.textSize,c=i.textColor,l=i.selectBoxColor;if(r&&(n._brushColor=r),s&&(n._brushThin=s),a){var d="normal",p="normal";switch(a){case t.EBoardTextStyle.BOLD:p="bold";break;case t.EBoardTextStyle.ITALIC:d="italic";break;case t.EBoardTextStyle.BOLD_ITALIC:d="italic",p="bold"}n._textStyle=d,n._textWeight=p}h&&(n._textSize=h),c&&(n._textColor=c),l&&(n._selectBoxColor=l)}return n}return o(n,e),Object.defineProperty(n.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"canUndoList",{get:function(){return this._canUndoList},set:function(t){this._canUndoList=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"canRedoList",{get:function(){return this._canRedoList},set:function(t){this._canRedoList=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"brushColor",{get:function(){return this._brushColor},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"brushType",{get:function(){return this._toolType},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"brushThin",{get:function(){return this._brushThin},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"backgroundColor",{get:function(){return this.options.backgroundColor},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"brushId",{get:function(){return this.uid+"_"+Date.now()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectPenId",{get:function(){return"selector_"+(ht+=1)},enumerable:!1,configurable:!0}),n.prototype.setEnable=function(t){"boolean"==typeof t?this._enabled!==t&&(this._enabled=t,tt.info("set board enable as "+t)):tt.info("set board enable failed")},n.prototype.getEnable=function(){return this._enabled},n.prototype.getNeedUpdateShapeData=function(){var t=this._needUpdateShapeData;return this._needUpdateShapeData=null,t},n.prototype.setBrushType=function(e){var o=this;if(e!==t.EBoardToolType.NONE&&e!==t.EBoardToolType.SELECT&&e!==t.EBoardToolType.FREE_DRAW&&e!==t.EBoardToolType.TEXT&&e!==t.EBoardToolType.RECT&&e!==t.EBoardToolType.LINE&&e!==t.EBoardToolType.ELLIPSE&&e!==t.EBoardToolType.ARROW&&e!==t.EBoardToolType.ERASER&&e!==t.EBoardToolType.LASER_POINTER)throw new nt(D);tt.info("set brush type as "+e),this._setBrushCursor(e),this._selectShapes.length>0&&(this._displayList.forEach((function(t,e){o._selectShapes.includes(e)&&o.drawToCachePainter(t)})),this._selectShapes=[],this.hideControlWrap(),this._renderTemporaryCanvas())},n.prototype.setBrushColor=function(t){if("string"!=typeof t)throw new nt(D);tt.info("set brush color as "+t),this._brushColor=t},n.prototype.setBrushThin=function(t){if(!("number"==typeof t&&t>=1&&t<=20))throw new nt(D);this._brushThin=t,tt.info("set brush thin as "+t)},n.prototype.setTextStyle=function(){},n.prototype.getTextStyle=function(){},n.prototype.setLineStyle=function(){},n.prototype.getLineStyle=function(){},n.prototype.setTextSize=function(t){this._textSize=t},n.prototype.getTextSize=function(){return this._textSize},n.prototype.setTextColor=function(t){this._textColor=t},n.prototype.getTextColor=function(){return this._textColor},n.prototype.setBoardRatio=function(t){this.options.ratio=t,this.renderSize()},n.prototype.getBoardRatio=function(){return this.options.ratio},n.prototype.setSelectBoxColor=function(t){this._selectBoxColor=t},n.prototype.scalePainter=function(t){this.options.scale=t,this.renderSize()},n.prototype.undo=function(){var t=this._canUndoList.pop();if(t){var e=t.type;t.shapes,this._canRedoList.push(t),this._selectShapes=[],this.renderControlBox();var o=t.shapes[0],i=new at[o.type](o.id,{props:o._props,position:o.position,style:o.style}),n=void 0;if(e===u.ADD_SHAPE){var r={pIds:[i.id]};n={bId:this.id,action:u.DELETE_SHAPE,data:r},this.removeElement(i.id)}else if(e===u.DELETE_SHAPE){var s={pId:i.id,shape:i.type,props:i.props,position:i.position,style:i.style,width:this.width,height:this.height,lts:Date.now()};n={bId:this.id,action:u.ADD_SHAPE,data:s},this.addElement(i)}else if(e===u.MOVE_SHAPE){var h=t.offset,c=t.shapes,l=a(h,2),d=l[0],p=l[1];this.moveElement(c.map((function(t){return t.id})),[-1*d*this.width,-1*p*this.height]);var _={pIds:c.map((function(t){return t.id})),offset:[-1*d,-1*p]};n={bId:this.id,action:u.MOVE_SHAPE,data:_}}this.emit("reportContent",n)}},n.prototype.redo=function(){var t=this._canRedoList.pop();if(t){this._canUndoList.push(t);var e=t.shapes[0],o=new at[e.type](e.id,{props:e._props,position:e.position,style:e.style}),i=void 0;if(t.type===u.ADD_SHAPE){var n={pId:o.id,shape:o.type,props:o.props,position:o.position,style:o.style,width:this.width,height:this.height,lts:Date.now()};i={bId:this.id,action:u.ADD_SHAPE,data:n},this.addElement(o)}else if(t.type===u.DELETE_SHAPE){var r={pIds:[o.id]};i={bId:this.id,action:u.DELETE_SHAPE,data:r},this.removeElement(o.id)}else if(t.type===u.MOVE_SHAPE){var s=t.offset,h=t.shapes,c=a(s,2),l=c[0],d=c[1];this.moveElement(h.map((function(t){return t.id})),[l*this.width,d*this.height]);var p={pIds:h.map((function(t){return t.id})),offset:[l,d]};i={bId:this.id,action:u.MOVE_SHAPE,data:p}}this.emit("reportContent",i)}},n.prototype.addElement=function(t){if(this._displayList.get(t.id))throw Error("can not add again");if(!this._temporaryList.get(t.id)){if(t instanceof F){var e=document.querySelectorAll(".board-laser_item"),o=!1;e.forEach((function(e){e.getAttribute("data-uid")===t.id&&(o=!0)})),!o&&t.buildElement(this._cursorWrap)}else this.drawToCachePainter(t);this._displayList.set(t.id,t)}},n.prototype.removeElement=function(t){var e=this,o=this._displayList.get(t);if(o){this._displayList.delete(t);var i=this._selectShapes.findIndex((function(e){return e===t}));~i&&this._selectShapes.splice(i,1),this.renderControlBox(),o instanceof F?document.querySelectorAll(".board-laser_item").forEach((function(e){e.getAttribute("data-uid")===t&&e.remove()})):(this.clearCachePainter(),this._displayList.forEach((function(t){e.drawToCachePainter(t)})))}},n.prototype.moveElement=function(t,e){var o=this,i=a(e,2),n=i[0],r=i[1];this.clearCachePainter(),this._displayList.forEach((function(e,i){t.includes(e.id)?(null==e?void 0:e.type)===p.LASER_POINTER?(null==e||e.attr("position",[n,r]),e.setPosition(n,r)):(null==e||e.attr("position",[e.position[0]+n,e.position[1]+r]),o.drawToCachePainter(e)):o.drawToCachePainter(e)}))},n.prototype.refreshElement=function(t){var e=this._displayList.get(t);e&&e.buildPath(this._canvasCtx,e)},n.prototype.findElement=function(t){return this._displayList.get(t)},n.prototype.renderControlBox=function(){var t=this;if(this._selectShapes.length>0){var e=[],o=[],i=[],n=[];this._selectShapes.forEach((function(r){var s=t._displayList.get(r),a=null==s?void 0:s.getBoundingRect();e.push(a.x),o.push(a.y),i.push(a.x+a.width),n.push(a.y+a.height)})),this._controlBoxPosition=[Math.min.apply(Math,h([],a(e))),Math.min.apply(Math,h([],a(o))),Math.max.apply(Math,h([],a(i))),Math.max.apply(Math,h([],a(n)))],this.setControlBoxSize(this._controlBoxPosition),this.showControlWrap()}else this.hideControlWrap()},n.prototype.clearCanvas=function(){this.clearPainter(),this.clearCachePainter(),this._displayList.clear()},n.prototype.clearAllLaserPointer=function(){this._cursorWrap.innerHTML=""},n.prototype.clearOtherLaserPointer=function(){var t=this;this._displayList.forEach((function(e){e instanceof F&&e.id!==t.uid&&document.querySelectorAll(".board-laser_item").forEach((function(t){t.getAttribute("data-uid")!==e.id&&t.remove()}))}))},n.prototype.clearSelfLaserPoint=function(){var t=this;this._displayList.forEach((function(e){e instanceof F&&e.id!==t.uid&&document.querySelectorAll(".board-laser_item").forEach((function(t){t.getAttribute("data-uid")===e.id&&t.remove()}))}))},n.prototype.clear=function(t){void 0===t&&(t=!1),this.clearPainter(),this.clearCachePainter(),this._displayList.clear(),t||(this._selectShapes=[],this.hideControlWrap())},n.prototype.reset=function(){this.clearPainter(),this.clearCachePainter(),this._displayList.clear(),this._temporaryList.clear(),this._canUndoList=[],this._canRedoList=[],this._selectShape&&(this._selectShape=null),this._currentShape&&(this._toolType===t.EBoardToolType.FREE_DRAW?this._currentShape.props.points.length>1?(this._canUndoList.push({type:u.ADD_SHAPE,shapes:[this._currentShape]}),this.emit("reportContent",this._needUpdateShapeData),this._needUpdateShapeData=null):this.removeElement(this._currentShape.id):(this._canUndoList.push({type:u.ADD_SHAPE,shapes:[this._currentShape]}),this.emit("reportContent",this._needUpdateShapeData),this._needUpdateShapeData=null),this._currentShape=null)},n.prototype.clearAll=function(){this.clear(),this._canUndoList=[],this._canRedoList=[],this._cursorWrap.innerHTML=""},n.prototype.clearBackground=function(){this.setCanvasBGColor("#ffffff"),this.setCanvasBGImage("")},n.prototype._initCurrentShape=function(e,o){var n=this,r={};if(this._startPosition=[e,o],this._toolType===t.EBoardToolType.SELECT){var s=new z(this.selectPenId,{props:{x1:e,y1:o,x2:e,y2:o},style:i(i({},l.BOARD_SELECT_STYLE),{strokeStyle:this._selectBoxColor})});this._selectShape=this._createProxySetHandle(s,(function(t,e,o,i){if("props"===e||"position"===e||"style"===e){t[e]=o;var r=n._controlBoxPosition[0],s=n._controlBoxPosition[1],a=n._controlBoxPosition[2],h=n._controlBoxPosition[3];n._selectShapes=[];var c=t.getBoundingRect(),l=[c.x,c.y,c.x+c.width,c.y+c.height];n._displayList.forEach((function(t,e){var o,i,c,d,p,u,_,f,v,E,y=t.getBoundingRect(),g=[y.x,y.y,y.x+y.width,y.y+y.height];if(i=g,c=(o=l)[0],d=o[1],p=o[2],u=o[3],_=i[0],f=i[1],v=i[2],E=i[3],c<=_&&d<=f&&v<=p&&E<=u){var S=t.getBoundingRect();0===n._selectShapes.length&&(r=S.x,s=S.x+S.width,a=S.y,h=S.y+S.height),r=r<S.x?r:S.x,s=s<S.x+S.width?S.x+S.width:s,a=a<S.y?a:S.y,h=h<S.y+S.height?S.y+S.height:h,n._selectShapes.push(t.id)}})),n._controlBoxPosition=[r,a,s,h],n.clearPainter(),n._renderTemporaryCanvas(),n._drawToPainter(t)}}))}else if(this.brushType===t.EBoardToolType.FREE_DRAW){(d=[]).push(h([],a(this._startPosition))),r={points:d};var c=new G(this.brushId,{props:r,style:{lineWidth:this._brushThin,strokeStyle:this._brushColor}});this._currentShape=c}else if(this._toolType===t.EBoardToolType.ARROW){var d=h(h([],a(this._startPosition)),a(this._startPosition));r={points:Q(d,2.5*this._brushThin)};var p=new k(this.brushId,{props:r,style:{lineWidth:this._brushThin,strokeStyle:this._brushColor}});this._currentShape=p}else if(this._toolType===t.EBoardToolType.LINE){r={x:this._startPosition[0],y:this._startPosition[1],x1:this._startPosition[0],y1:this._startPosition[1]};var u=new K(this.brushId,{props:r,style:{lineWidth:this._brushThin,strokeStyle:this._brushColor}});this._currentShape=u}else if(this._toolType===t.EBoardToolType.RECT){r={x1:e,y1:o,x2:e,y2:o};var _=new z(this.brushId,{props:r,style:{lineWidth:this._brushThin,strokeStyle:this._brushColor}});this._currentShape=_}else if(this._toolType===t.EBoardToolType.ELLIPSE){r={cx:this._startPosition[0],cy:this._startPosition[1],xr:0,yr:0};var f=new U(this.brushId,{props:r,style:{lineWidth:this._brushThin,strokeStyle:this._brushColor}});this._currentShape=f}this._currentShape&&this._toolType!==t.EBoardToolType.SELECT&&this._temporaryList.set(this._currentShape.id,this._currentShape)},n.prototype.handleMouseDown=function(e){if(this._toolType!==t.EBoardToolType.NONE&&this._enabled){var o=0,i=0;if(e instanceof MouseEvent)o=e.offsetX,i=e.offsetY;else if(e instanceof TouchEvent){var n=this._canvas.getBoundingClientRect();o=e.touches[0].clientX-n.left,i=e.touches[0].clientY-n.top}var r=X(Math.floor(o),1),s=X(Math.floor(i),1);if(this._toolType===t.EBoardToolType.LASER_POINTER){if(!this._laserPointer&&e instanceof TouchEvent&&"touchstart"===e.type||e instanceof MouseEvent&&"mouseenter"===e.type){var a=new F(this.uid+"LaserPointer",{props:{cx:r,cy:s,r:10}});e instanceof TouchEvent&&(a.touchId=e.touches[0].identifier),this._laserPointer=a,this._laserPointer.buildElement(this._cursorWrap);var h={pId:a.id,width:this.width,height:this.height,shape:a.type,props:a.props,style:a.style,position:a.position,lts:Date.now()},c={bId:this.id,action:u.ADD_SHAPE,data:h};this.emit("reportContent",c)}}else if(this._toolType===t.EBoardToolType.ERASER||this._toolType===t.EBoardToolType.TEXT)(e instanceof TouchEvent&&"touchstart"===e.type||e instanceof MouseEvent&&"mousedown"===e.type&&0===e.button)&&(this._toolType===t.EBoardToolType.ERASER?this._eraserShape(r,s):this._toolType===t.EBoardToolType.TEXT&&(e.preventDefault(),e.stopPropagation(),this._textInput?(this._textInput.blur(),this._textInput=null):this._createTextInputAndHandleChange(r,s)));else if(this._toolType!==t.EBoardToolType.SELECT){if(e instanceof MouseEvent&&"mouseenter"===e.type)return;(e instanceof TouchEvent&&"touchstart"===e.type||e instanceof MouseEvent&&"mousedown"===e.type&&e.buttons%2!=0)&&(this._startPosition=[r,s],!this._currentShape&&this._initCurrentShape(r,s))}}},n.prototype.handleMouseMove=function(e){var o,n,r,s,c,l,d,p,_,f,v,E,y,g;if(this._enabled&&this._toolType!==t.EBoardToolType.NONE){var S=0,T=0;if(e instanceof MouseEvent)S=e.offsetX,T=e.offsetY;else if(e instanceof TouchEvent){var m=this._canvas.getBoundingClientRect();S=e.touches[0].clientX-m.left,T=e.touches[0].clientY-m.top}var b=X(Math.floor(S),1),C=X(Math.floor(T),1),A=[b,C];if(this._toolType===t.EBoardToolType.LASER_POINTER){if(this._laserPointer instanceof F&&(e instanceof TouchEvent&&"touchmove"===e.type||e instanceof MouseEvent&&"mousemove"===e.type)){0===this._latestMovePosition.length&&(this._latestMovePosition=[b,C]);var I=b-this._latestMovePosition[0],D=C-this._latestMovePosition[1];this._latestMovePosition=[b,C],this._laserPointer.setPosition(this._laserPointer.position[0]+I,this._laserPointer.position[1]+D);var x={pIds:[this._laserPointer.id],offset:[this._laserPointer.position[0]/this.width,this._laserPointer.position[1]/this.height]},w={bId:this.id,action:u.MOVE_SHAPE,data:x};this._needUpdateShapeData=w}}else if(this._toolType===t.EBoardToolType.SELECT&&(e instanceof TouchEvent&&"touchmove"===e.type||e instanceof MouseEvent&&"mousemove"===e.type&&e.buttons%2!=0))!this._selectShape&&this._initCurrentShape(b,C),this._selectShape.attr("props",{x2:A[0],y2:A[1]});else if(this._toolType!==t.EBoardToolType.ERASER&&this._toolType!==t.EBoardToolType.TEXT&&this._currentShape){var B=this._currentShape.style,R=B.strokeStyle;B.fillStyle;var O={};R&&(O.strokeStyle=this._brushColor),null===(o=this._currentShape)||void 0===o||o.attr("style",O);var L={pId:this._currentShape.id,shape:this._currentShape.type,style:this._currentShape.style,props:this._needUpdateShapeData?null===(r=null===(n=this._needUpdateShapeData)||void 0===n?void 0:n.data)||void 0===r?void 0:r.props:{},width:this.width,height:this.height,position:[0,0],lts:Date.now()};w={bId:this.id,action:u.ADD_SHAPE,data:L};if(this._toolType===t.EBoardToolType.FREE_DRAW){var P=(null===(s=this._currentShape)||void 0===s?void 0:s.props.points)||[],N=(null===(c=null==L?void 0:L.props)||void 0===c?void 0:c.points)||[];if(A[0]!==P[P.length-1][0]||A[1]!==P[P.length-1][1]){P.push(h([],a(A))),N.push([A[0],A[1]]);var M={points:P};null===(l=this._currentShape)||void 0===l||l.attr("props",M),this._renderTemporaryCanvas(),L.props={points:N},w.data=L,this._needUpdateShapeData=w}}else if(this._toolType===t.EBoardToolType.LINE){M=i(i({},null===(d=this._currentShape)||void 0===d?void 0:d.props),{x1:A[0],y1:A[1]});L.props=M,null===(p=this._currentShape)||void 0===p||p.attr("props",M),this._renderTemporaryCanvas(),w.data=L,this._needUpdateShapeData=w}else if(this._toolType===t.EBoardToolType.ARROW){P=h(h([],a(this._startPosition)),a(A));var k=Q(P,2.5*this._brushThin);M=i(i({},null===(_=this._currentShape)||void 0===_?void 0:_.props),{points:k});L.props=M,null===(f=this._currentShape)||void 0===f||f.attr("props",M),this._renderTemporaryCanvas(),w.data=L,this._needUpdateShapeData=w}else if(this._toolType===t.EBoardToolType.ELLIPSE){var W=function(t){var e=a(t,4),o=e[0],i=e[1],n=e[2],r=e[3],s=Math.abs(n-o)/2,h=Math.abs(r-i)/2;return[o<n?o+s:n+s,i<r?i+h:r+h,s,h]}(P=h(h([],a(this._startPosition)),a(A)));M=i(i({},null===(v=this._currentShape)||void 0===v?void 0:v.props),{cx:X(W[0],1),cy:X(W[1],1),xr:X(W[2],1),yr:X(W[3],1)});L.props=M,null===(E=this._currentShape)||void 0===E||E.attr("props",M),this._renderTemporaryCanvas(),w.data=L,this._needUpdateShapeData=w}else if(this._toolType===t.EBoardToolType.RECT){M=i(i({},null===(y=this._currentShape)||void 0===y?void 0:y.props),{x2:A[0],y2:A[1]});L.props=M,null===(g=this._currentShape)||void 0===g||g.attr("props",M),this._renderTemporaryCanvas(),w.data=L,this._needUpdateShapeData=w}}}},n.prototype.handleMouseUp=function(e){var o=this;if(this._enabled&&this._toolType!==t.EBoardToolType.NONE){var i=0,n=0;if(e instanceof MouseEvent)i=e.offsetX,n=e.offsetY;else if(e instanceof TouchEvent){var r=this._canvas.getBoundingClientRect();i=e.changedTouches[0].clientX-r.left,n=e.changedTouches[0].clientY-r.top}var s=X(Math.floor(i),1),a=X(Math.floor(n),1);if(this._endPosition=[s,a],this._toolType!==t.EBoardToolType.LASER_POINTER)if(this._toolType===t.EBoardToolType.SELECT&&this._selectShape){if(Math.abs(this._endPosition[0]-this._startPosition[0])<=1&&Math.abs(this._endPosition[1]-this._startPosition[1])<=1){var h=[];if(this._displayList.forEach((function(t){t.type===p.TEXT?t.isPointInPath(i,n)&&(h=[t]):o._isPointInShape(i,n,t)&&(h=[t])})),h.length>0){this._selectShapes=[h[0].id];var c=h[0].getBoundingRect(),l=c.x,d=c.y,_=c.x+c.width,f=c.y+c.height;this.setControlBoxSize([l,d,_,f]),this.showControlWrap()}}else this.clearPainter(),this._selectShapes.length>0&&(this.showControlWrap(),this.setControlBoxSize(this._controlBoxPosition));this._selectShape=null}else this._toolType!==t.EBoardToolType.ERASER&&this._toolType!==t.EBoardToolType.TEXT&&(this._currentShape&&e instanceof MouseEvent&&"mouseup"===e.type&&0===e.button||e instanceof MouseEvent&&"mouseout"===e.type||e instanceof TouchEvent&&"touchend"===e.type)&&(this._currentShape&&(this._toolType===t.EBoardToolType.FREE_DRAW?this._currentShape.props.points.length>1?(this._canUndoList.push({type:u.ADD_SHAPE,shapes:[this._currentShape]}),this.emit("reportContent",this._needUpdateShapeData),this._needUpdateShapeData=null):this.removeElement(this._currentShape.id):(this._canUndoList.push({type:u.ADD_SHAPE,shapes:[this._currentShape]}),this.emit("reportContent",this._needUpdateShapeData),this._needUpdateShapeData=null),this._displayList.set(this._currentShape.id,this._currentShape),this.drawToCachePainter(this._currentShape),this._temporaryList.delete(this._currentShape.id),this._renderTemporaryCanvas()),this._currentShape=null);else if(this._laserPointer&&e instanceof TouchEvent&&("touchend"===e.type||"touchcancel"===e.type)||e instanceof MouseEvent&&"mouseout"===e.type){if(e instanceof TouchEvent&&("touchend"===e.type||"touchcancel"===e.type)){var v=this._laserPointer.touchId,E=!1;for(var y in e.changedTouches){if(e.changedTouches[y].identifier===v){E=!0;break}}if(!E)return}this._needUpdateShapeData=null,this.emit("reportContent",{bId:this.id,action:u.DELETE_SHAPE,data:{pIds:[this._laserPointer.id]}}),this._laserPointer.dispose(),this._laserPointer=null,this._latestMovePosition=[]}}},n.prototype.handleControlBoxMouseDown=function(t){if(t instanceof TouchEvent&&"touchstart"===t.type||t instanceof MouseEvent&&"mousedown"===t.type){var e=0,o=0;t instanceof MouseEvent?(e=t.pageX,o=t.pageY):t instanceof TouchEvent&&(e=t.touches[0].pageX,o=t.touches[0].pageY),t.target===this._controlBox?(this.selectStartPosition.length<=0&&(this.selectStartPosition=[e,o],this.selectLatestMovePosition=[e,o]),t.stopPropagation(),t.preventDefault()):t.target===this._controlWrap&&this._selectShapes.length>0&&(this.hideControlWrap(),this._selectShapes=[])}},n.prototype.handleControlBoxMouseMove=function(t){var e=this,o=0,i=0;if(t instanceof MouseEvent?(o=t.pageX,i=t.pageY):t instanceof TouchEvent&&(o=t.touches[0].pageX,i=t.touches[0].pageY),(t instanceof TouchEvent&&"touchmove"===t.type||t instanceof MouseEvent&&"mousemove"===t.type&&t.buttons%2!=0)&&this.selectStartPosition.length>0){var n=o-this.selectLatestMovePosition[0],r=i-this.selectLatestMovePosition[1];e._controlBoxPosition[0]+=n,e._controlBoxPosition[1]+=r,e._controlBoxPosition[2]+=n,e._controlBoxPosition[3]+=r,e._controlBox.style.pointerEvents="none",e.setControlBoxPosition(e._controlBoxPosition),this.moveElement(e._selectShapes,[n,r]),this.selectLatestMovePosition=[o,i]}},n.prototype.handleControlBoxMouseUp=function(t){var e=this;if((t instanceof TouchEvent||"mouseup"===t.type||t instanceof MouseEvent&&"mouseout"===t.type&&t.target===this._controlWrap&&t.buttons%2!=0)&&this.selectStartPosition.length>0){if(Math.abs(this.selectLatestMovePosition[0]-this.selectStartPosition[0])<=1&&Math.abs(this.selectLatestMovePosition[1]-this.selectStartPosition[1])<=1);else{var o=this.selectLatestMovePosition[0]-this.selectStartPosition[0],i=this.selectLatestMovePosition[1]-this.selectStartPosition[1],n={bId:this.id,action:u.MOVE_SHAPE,data:{pIds:this._selectShapes,offset:[o/this.width,i/this.height]}},r=this._selectShapes.map((function(t){return e._displayList.get(t)}));this._canUndoList.push({type:u.MOVE_SHAPE,shapes:r,offset:[o/this.width,i/this.height]}),this.emit("reportContent",n)}this.selectStartPosition=[],this.selectLatestMovePosition=[],this._controlBox.style.pointerEvents="all"}},n.prototype.releaseMouse=function(){switch(this._toolType){case t.EBoardToolType.ARROW:case t.EBoardToolType.ELLIPSE:case t.EBoardToolType.ERASER:case t.EBoardToolType.FREE_DRAW:case t.EBoardToolType.LINE:case t.EBoardToolType.RECT:case t.EBoardToolType.TEXT:this._currentShape&&(this._currentShape=null,this._temporaryList.clear());break;case t.EBoardToolType.LASER_POINTER:this._laserPointer&&(this._laserPointer=null,this._latestMovePosition=[]);break;case t.EBoardToolType.SELECT:this._selectShape&&(this._selectShape=null,this._selectShapes=[])}this._needUpdateShapeData&&(this.emit("reportContent",this._needUpdateShapeData),this._needUpdateShapeData=null)},n.prototype.clearPainter=function(){this._canvasCtx.clearRect(0,0,this.width,this.height)},n.prototype.clearCachePainter=function(){this._cacheCanvasCtx.clearRect(0,0,this.width,this.height)},n.prototype.clearText=function(){this._textBox.innerHTML=""},n.prototype.drawCacheToMain=function(){this._canvasCtx.drawImage(this._cacheCanvas,0,0)},n.prototype._renderTemporaryCanvas=function(){var t=this;this.clearPainter(),this._temporaryList.forEach((function(e){t._drawToPainter(e)}))},n.prototype._drawToPainter=function(t){t.buildPath(this._canvasCtx,t)},n.prototype.drawToCachePainter=function(t){t.buildPath(this._cacheCanvasCtx,t)},n.prototype._handleShapeAttr=function(t,e){var o=this;return this._createProxySetHandle(t,(function(t,i,n,r){e&&e(t,i,n,r),"props"!==i&&"style"!==i||(t[i]=n,o.clearPainter(),t instanceof F?t.setPosition(t.position[0],t.position[1]):o._drawToPainter(t))}))},n.prototype._createProxySetHandle=function(t,e){return new Proxy(t,{set:function(t,o,i,n){return e(t,o,i,n),Reflect.set(t,o,i,n)}})},n.prototype._setBrushCursor=function(e){this._toolType=e;var o="";switch(e){case t.EBoardToolType.SELECT:case t.EBoardToolType.ARROW:case t.EBoardToolType.LINE:case t.EBoardToolType.RECT:case t.EBoardToolType.ELLIPSE:o="crosshair";break;case t.EBoardToolType.FREE_DRAW:var i=decodeURIComponent("data:image/svg+xml,%3c%3fxml version='1.0' encoding='UTF-8'%3f%3e%3csvg width='32px' height='32px' viewBox='0 0 32 32' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e %3ctitle%3efree-hand%3c/title%3e %3cdefs%3e %3cpath d='M1427.058%2c345.43405 C1427.254%2c345.23905 1427.571%2c345.23905 1427.766%2c345.43405 L1427.766%2c345.43405 L1433.374%2c351.04305 C1433.472%2c351.14005 1433.521%2c351.26805 1433.521%2c351.39605 C1433.521%2c351.52505 1433.472%2c351.65305 1433.374%2c351.75005 L1433.374%2c351.75005 L1423.463%2c361.72705 C1423.369%2c361.82105 1423.242%2c361.87405 1423.109%2c361.87405 L1423.109%2c361.87405 L1417.501%2c361.87405 C1417.224%2c361.87405 1417%2c361.65005 1417%2c361.37305 L1417%2c361.37305 L1417%2c355.76505 C1417%2c355.63205 1417.053%2c355.50505 1417.147%2c355.41105 L1417.147%2c355.41105 Z M1430.546%2c341.94725 C1431.808%2c340.68425 1433.855%2c340.68425 1435.118%2c341.94725 L1435.118%2c341.94725 L1436.862%2c343.69125 C1437.493%2c344.32225 1437.809%2c345.14925 1437.809%2c345.97725 C1437.809%2c346.80425 1437.493%2c347.63225 1436.862%2c348.26325 L1436.862%2c348.26325 L1435.815%2c349.31025 C1435.618%2c349.50725 1435.299%2c349.50725 1435.102%2c349.31025 L1435.102%2c349.31025 L1429.498%2c343.70625 C1429.4%2c343.60825 1429.351%2c343.47925 1429.351%2c343.35025 C1429.351%2c343.22125 1429.4%2c343.09225 1429.498%2c342.99425 L1429.498%2c342.99425 Z' id='path-1'%3e%3c/path%3e %3c/defs%3e %3cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3e %3cg transform='translate(-1416.000000%2c -331.000000)'%3e %3cuse stroke='%235A5A67' stroke-width='2' fill='%235A5A67' fill-rule='evenodd' xlink:href='%23path-1'%3e%3c/use%3e %3cuse stroke='white' stroke-width='1' xlink:href='%23path-1'%3e%3c/use%3e %3c/g%3e %3c/g%3e%3c/svg%3e");o='url("data:image/svg+xml;base64,'+btoa(i.split("data:image/svg+xml,")[1])+'") 0 36, crosshair';break;case t.EBoardToolType.ERASER:var n=decodeURIComponent("data:image/svg+xml,%3c%3fxml version='1.0' encoding='UTF-8'%3f%3e%3csvg width='32px' height='32px' viewBox='0 0 32 32' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e %3ctitle%3eeraser%3c/title%3e %3cdefs%3e %3cpath d='M1542.63604%2c401.636491 C1542.64212%2c401.642264 1542.64811%2c401.648114 1542.65404%2c401.654038 L1549.74863%2c408.748632 C1550.12256%2c409.122557 1550.14072%2c409.722967 1549.79008%2c410.11881 L1542.80885%2c417.999142 L1532.31285%2c417.999142 L1529.38519%2c415.711238 C1528.95%2c415.371189 1528.87288%2c414.742739 1529.21293%2c414.307554 C1529.23283%2c414.282078 1529.25396%2c414.257582 1529.27624%2c414.234152 L1541.22228%2c401.672031 C1541.60286%2c401.271816 1542.23583%2c401.255904 1542.63604%2c401.636491 Z' id='path-1'%3e%3c/path%3e %3crect id='path-2' x='1539.73654' y='400.606602' width='14' height='8' rx='1'%3e%3c/rect%3e %3c/defs%3e %3cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3e %3cg transform='translate(-1528.000000%2c -387.000000)'%3e %3cg%3e %3cuse stroke='%235A5A67' stroke-width='2' fill='%235A5A67' fill-rule='evenodd' xlink:href='%23path-1'%3e%3c/use%3e %3cuse stroke='white' stroke-width='1' xlink:href='%23path-1'%3e%3c/use%3e %3c/g%3e %3cg transform='translate(1546.736544%2c 404.606602) rotate(-315.000000) translate(-1546.736544%2c -404.606602) '%3e %3cuse stroke='%235A5A67' stroke-width='2' fill='white' fill-rule='evenodd' xlink:href='%23path-2'%3e%3c/use%3e %3cuse stroke='white' stroke-width='1' xlink:href='%23path-2'%3e%3c/use%3e %3c/g%3e %3c/g%3e %3c/g%3e%3c/svg%3e");o='url("data:image/svg+xml;base64,'+btoa(n.split("data:image/svg+xml,")[1])+'") 3 36, crosshair';break;case t.EBoardToolType.TEXT:o="text";break;case t.EBoardToolType.LASER_POINTER:o="none";break;default:o="default"}this._canvas.style.cursor=o},n.prototype._isPointInShape=function(t,e,o){var i=H({kind:"canvas",props:{width:this.width,height:this.height},style:{}}).el.getContext("2d");return o.buildPath(i,o),0!==i.getImageData(t,e,1,1).data[3]},n.prototype._eraserShape=function(t,e){var o,i=this;if(this._displayList.forEach((function(n){n instanceof j?n.isPointInPath(t,e)&&(o=n):i._isPointInShape(t,e,n)&&(o=n)})),o){this._displayList.delete(o.id);var n={bId:this.id,action:u.DELETE_SHAPE,data:{pIds:[o.id]}};this.emit("reportContent",n),this._canUndoList.push({type:u.DELETE_SHAPE,shapes:[o]}),this.clearCachePainter(),this._displayList.forEach((function(t){i.drawToCachePainter(t)}))}},n.prototype._addInputElement=function(t,e,o){var n=(this.boxWidth-this.width)/2,r=(this.boxHeight-this.height)/2,s=H({kind:"textarea",props:i({},l.TEXT_INPUT_ELEMENT_OPTIONS.props),style:i(i({},l.TEXT_INPUT_ELEMENT_OPTIONS.style),{top:o+r+"px",left:e+n+"px","max-width":this.boxWidth-e+"px","max-height":this.boxHeight-o+"px","white-space":"pre-wrap","box-sizing":"content-box",outline:"none",resize:"none","word-break":"break-all",color:this._textColor,"font-style":this._textStyle,"font-size":this._textSize+"px","font-weight":this._textWeight,"line-height":this._textSize+"px","min-width":this._textSize+"px","min-height":this._textSize+"px"})}).el;return this.createTextInput(s),s},n.prototype._createTextInputAndHandleChange=function(t,e){var o=this,i={},n=this.brushId,r=this._addInputElement(n,t,e);this._textInput=r;var s=this.boxWidth-t;r.onfocus=function(t){t.target.style.border="1px dashed rgba(167, 156, 156,1)"},r.focus(),requestAnimationFrame((function(){return r.focus()})),r.oninput=function(t){var e=t.target.value,i=V(e,{fontSize:o._textSize,fontStyle:o._textStyle,fontWeight:o._textWeight,lineHeight:o._textSize,fontFamily:"customFontFamily, sans-serif, serif, monospace"},s),n=i.width,r=i.height;i.list,t.target.style.width=n+2+"px",t.target.style.height=r+2+"px"},r.onblur=function(n){var s=r.value;if(s){i={text:s,fontSize:o._textSize,lineHeight:o._textSize,x:t,y:e,maxWidth:o.boxWidth-t,maxHeight:o.boxHeight-e};var a=new j(o.brushId,{props:i,style:{textFill:o._textColor,textStyle:o._textStyle,textWeight:o._textWeight}});o.drawToCachePainter(a);var h=o._handleShapeAttr(a);o._displayList.set(a.id,h),o._canUndoList.push({type:u.ADD_SHAPE,shapes:[a]});var c={bId:o.id,action:u.ADD_SHAPE,data:{pId:a.id,width:o.width,height:o.height,shape:a.type,props:a.props,style:a.style,position:a.position,lts:Date.now()}};o.emit("reportContent",c)}r.remove(),o._textInput=null}},n}(st),lt=function(){this.type=0,this.fId="#DEFAULT",this.url="",this.title="DEFAULT",this.currentPageIndex=1,this.totalPageCount=1,this.boardList=[],this.width=1920,this.height=1080},dt=function(){this.bId="",this.scale=100,this.ratio="16:9",this.color="#ffffff",this.image="",this.url="",this.pList=new Map,this.canUndoList=[],this.canRedoList=[]},pt=function(){function t(t){if(this._url="",this._wss=!0,this._port=443,this._timeout=6e4,"[object Object]"===Object.prototype.toString.call(t)){var e=t.url,o=t.wss,i=t.port,n=t.timeout;"string"==typeof e&&(this._url=e),"boolean"==typeof o&&(this._wss=o,this._port=o?443:80),"number"==typeof i&&(this._port=i),"number"==typeof n&&(this._timeout=n)}}return t.prototype.setRequestUrl=function(t){if("[object Object]"===Object.prototype.toString.call(t)){var e=t.url,o=t.wss,i=t.port;"string"==typeof e&&(this._url=e),"boolean"==typeof o&&(this._wss=o,this._port=o?443:80),"number"==typeof i&&(this._port=i)}},t.prototype.request=function(t,e,o){return this._sendUrlRequest(t,e,o)},t.prototype.post=function(t,e){return this.request(t,"POST",e)},t.prototype.get=function(t,e){return this.request(t,"GET",e)},t.prototype._sendUrlRequest=function(t,e,o,i){var n=this;return void 0===i&&(i=!0),new Promise((function(r,s){if(""!==n._url){var a=n._url;t&&(a=n._url+t);var h=new XMLHttpRequest;h.timeout=6e4;var c=function(){200===h.status?r(JSON.parse(h.responseText)):s(new nt(L))};i&&(h.onreadystatechange=function(t){4===h.readyState&&c()}),h.open(e,a,i),h.onerror=function(t){s(new nt(P))},h.ontimeout=function(){s(new nt(O))},h.send(JSON.stringify(o)),i||c()}else s("NO_REQUEST_URL")}))},t}(),ut=function(){function t(){this._urls=[],this._urlSuffix="/arapi/v1?action=",this._appid="",this._sessionId="",this._urls=[l.GATEWAY_ADDRESS],this._urlSuffix="/arapi/v1?action="}return t.prototype.joinGateway=function(t){var e=this;void 0===t&&(t={});var o=this;return new Promise((function(s,a){var h=o._urlSuffix.concat("wb_gateway"),c=function(){return n(e,void 0,void 0,(function(){var e,n,d,p,u,_;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Promise.race(this._urls.map((function(e){return new pt({url:e,timeout:l.GATEWAY_CONNECT_TIMEOUT}).post(h,i({},t))})))];case 1:if(e=r.sent())if(0===(n=e.code))d=e.sessionid,p=t.appId,o._sessionId=d,o._appid=p,s(e);else if(-1===n)setTimeout((function(){c()}),l.GATEWAY_CONNECT_TIMEOUT);else{if(-4===n||-7===n)throw new nt(y,"MISSING_PARAMETER");if(13===n)throw new nt(g,"DEVELOPER_INVALID");if(14===n)throw new nt(S,"UID_BANNED");if(15===n)throw new nt(T,"IP_BANNED");if(16===n)throw new nt(m,"CHANNEL_BANNED");if(101===n)throw new nt(b,"APPID_INVALID");if(102===n)throw new nt(C,"SERVER_NOT_OPEN");if(109===n)throw new nt(A,"TOKEN_EXPIRED You must request a new token from your server and call join to use the new token to join the channel");if(110===n)throw new nt(I,"TOKEN_INVALID make sure token is right and try angain please");setTimeout((function(){c()}),l.GATEWAY_CONNECT_TIMEOUT)}return[3,3];case 2:return u=r.sent(),"NETWORK_ERROR"===(_=u).code||"NETWORK_TIMEOUT"===_.code||"NETWORK_RESPONSE_ERROR"===_.code?(setTimeout((function(){c()}),l.GATEWAY_CONNECT_TIMEOUT),[2]):(a(_),[3,3]);case 3:return[2]}}))}))};c()}))},t}();t.EConnectionState=void 0,(et=t.EConnectionState||(t.EConnectionState={}))[et.DISCONNECTED=0]="DISCONNECTED",et[et.CONNECTING=1]="CONNECTING",et[et.RECONNECTING=2]="RECONNECTING",et[et.CONNECTED=3]="CONNECTED",et[et.DISCONNECTING=4]="DISCONNECTING";var _t=function(e){function i(o){var i=e.call(this)||this;if(i._websocket=null,i._url="",i._wss=!0,i._port=443,i.revState=t.EConnectionState.DISCONNECTED,i.curState=t.EConnectionState.DISCONNECTED,i.onclose=function(){},i.onerror=function(){},i.onmessage=function(){},o&&"[object Object]"===Object.prototype.toString.call(o)){var n=o.url,r=o.wss,s=o.port;n&&(i._url=n),"boolean"==typeof r&&(i._wss=r),s&&(i._port=s)}return i}return o(i,e),Object.defineProperty(i.prototype,"connectState",{get:function(){return this._websocket?this._websocket.readyState:WebSocket.CLOSED},enumerable:!1,configurable:!0}),i.prototype.open=function(t){var e=this;return new Promise((function(o,i){if(t&&"[object Object]"===Object.prototype.toString.call(t)){var n=t.url,r=t.wss,s=t.port;n&&(e._url=n),"boolean"==typeof r&&(e._wss=r),s&&(e._port=s)}var a=(e._wss?"wss":"ws")+"://"+e._url+":"+e._port;tt.debug("[ws-client] websocket opened: "+a),e._websocket=new WebSocket(a),e._websocket.onopen=function(){tt.debug("Signaling channel opened. "+a),e._websocket.onerror=function(t){tt.debug("Signaling channel error."),e.onerror(t)},e._websocket.onclose=function(t){tt.debug(e._url+" server closed with code: "+t.code+" reason: "+t.reason),e.onclose(t),e._websocket=null},o()},e._websocket.onmessage=function(t){e.onmessage(t)},e._websocket.onerror=function(t){i(Error("WebSocket error."))}}))},i.prototype.close=function(){this._websocket&&(this._websocket.close(),this._websocket=null)},i.prototype.send=function(t){"object"==typeof t?this._websocket&&1===this._websocket.readyState&&this._websocket.send(JSON.stringify(t)):tt.error("signal channel msg must be object.")},i.prototype.addMessageEventListener=function(t,e){if(this._websocket)return this._websocket.addEventListener("message",t,e)},i.prototype.removeMessageEventListener=function(t,e){if(this._websocket)return this._websocket.removeEventListener("message",t,e)},i.prototype.clear=function(){this.close(),this.onerror=function(){},this.onclose=function(){},this.onmessage=function(){},this.addMessageEventListener=function(){},this.removeMessageEventListener=function(){}},i}(it),ft=function(t){return t.then((function(t){return[null,t]})).catch((function(t){return[t]}))},vt=function(e){function i(t){var o=e.call(this)||this;o._cmdEncrypt=!1,o._appId="",o._serverIsWss=!0,o._serverUrl="",o._serverPort=0,o._channel=null,o._userId=null,o._connectTimeout=0,o._keepAliveTimeout=0,o._keepALiveInterval=0,o._keepALiveIntervalTime=1e4,o.handleMediaServerEvents=function(){};var i=o;return t&&t.appId&&(i._appId=t.appId),o}return o(i,e),i.prototype.send=function(t){e.prototype.send.call(this,t)},i.prototype.init=function(t){var e=this,o=t.appId,i=t.isWss,n=t.url,r=t.port;o&&(e._appId=o),"boolean"==typeof i&&(e._serverIsWss=i),n&&(e._serverUrl=n),r&&(e._serverPort=r)},i.prototype.setAppInfo=function(t){var e=t.appId;this._appId=e},i.prototype.configServer=function(t,e,o){var i=this;i._serverIsWss=t,i._serverUrl=e,i._serverPort=o},i.prototype.connectServer=function(e,o,i){var s=this,h=this;return new Promise((function(c,l){return n(s,void 0,void 0,(function(){var n,s,d,p;return r(this,(function(r){switch(r.label){case 0:return h._emitConnectionState(t.EConnectionState.CONNECTING),h._setConnectTimeout(),[4,ft(h.open({url:h._serverUrl,wss:h._serverIsWss,port:h._serverPort}))];case 1:return n=a.apply(void 0,[r.sent(),2]),(s=n[0])?(h._clearConnectTimeout(),l(s),[3,4]):[3,2];case 2:return h._clearConnectTimeout(),h._emitConnectionState(t.EConnectionState.CONNECTED),this._channel=e,this._userId=o,[4,ft(this.doInit({appId:h._appId,chanId:e,uId:o,accessToken:i}))];case 3:if(d=a.apply(void 0,[r.sent(),2]),p=d[0])return h._clearConnectTimeout(),l(p),[2];c(),h.onmessage=function(t){var e=t.data,o=JSON.parse(e),i=o.cmd,n=o.data;if(o.errMsg,o.errCode,"CONNECT"===i);else h.handleMediaServerEvents&&h.handleMediaServerEvents(i,n)},h.onerror=function(t){tt.error("board server handle some error ",t)},h.onclose=function(e){var o=e.code,i=e.reason;switch(tt.info("board serve disconnected...",o),h._clearConnectTimeout(),h._clearKeepALiveTimeout(),o){case 1e3:case 1005:h._emitConnectionState(t.EConnectionState.DISCONNECTED,"LEAVE");break;case 3001:h._emitConnectionState(t.EConnectionState.RECONNECTING,"NETWORK_ERROR");break;default:tt.debug("bNode serve disconnected with code "+o+", reason "+i),h.curState!==t.EConnectionState.RECONNECTING&&h._emitConnectionState(t.EConnectionState.RECONNECTING,"SERVER_ERROR")}h.clear()},c(),r.label=4;case 4:return[2]}}))}))}))},i.prototype.doInit=function(t){var e=this;return new Promise((function(o,i){var n=""+Date.now(),r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var c=a.errCode,l=a.seqId;h===u.INIT&&n===l&&(e.removeMessageEventListener(r),0===c?o():(tt.warning("BOARD_SERVER_INIT_FAILED"),i("BOARD_SERVER_INIT_FAILED")))};e.addMessageEventListener(r);var s={cmd:u.INIT,seqId:n,data:t,rts:n};e.send(s)}))},i.prototype.doGetChannelInfo=function(){var t=this;return new Promise((function(e,o){var i=""+Date.now(),n=function(o){var r=o.data,s=JSON.parse(r),a=s.cmd;s.data,s.errMsg,s.errCode;var h=s.seqId;a===u.CHAN_DATA&&i===h&&(t.removeMessageEventListener(n),e())};t.addMessageEventListener(n);var r={cmd:u.CHAN_DATA,seqId:i,rts:i};t.send(r)}))},i.prototype.doAddFile=function(t,e){var o=this;return new Promise((function(i,n){var r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var c=a.errCode,l=a.seqId;h===u.ADD_FILE&&e===l&&(o.removeMessageEventListener(r),0===c?i():(tt.warning("ADD_FILE_FAILED"),n("ADD_FILE_FAILED")))};o.addMessageEventListener(r);var s={cmd:u.ADD_FILE,seqId:e,rts:e,data:t};o.send(s)}))},i.prototype.doAddBoard=function(t,e){var o=this;return new Promise((function(i,n){var r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var c=a.errCode,l=a.seqId;h===u.ADD_BOARD&&e===l&&(o.removeMessageEventListener(r),0===c?i():(tt.warning("ADD_BOARD_FAILED"),n("ADD_BOARD_FAILED")))};o.addMessageEventListener(r);var s={cmd:u.ADD_BOARD,seqId:e,data:t,rts:e};o.send(s)}))},i.prototype.doDeleteBoard=function(t,e){var o=this;return new Promise((function(i,n){var r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var c=a.errCode,l=a.seqId;h===u.DELETE_BOARD&&e===l&&(o.removeMessageEventListener(r),0===c?i():(tt.warning("DELETE_BOARD_FAILED"),n("DELETE_BOARD_FAILED")))};o.addMessageEventListener(r);var s={cmd:u.DELETE_BOARD,seqId:e,data:t,rts:e};o.send(s)}))},i.prototype.doSwitchBoard=function(t,e){var o=this;return new Promise((function(i,n){var r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var c=a.errCode,l=a.seqId;h===u.SWITCH_BOARD&&e===l&&(o.removeMessageEventListener(r),0===c?i():(tt.warning("SWITCH_BOARD_FAILED"),n("SWITCH_BOARD_FAILED")))};o.addMessageEventListener(r);var s={cmd:u.SWITCH_BOARD,seqId:e,data:t,rts:e};o.send(s)}))},i.prototype.doResetBoard=function(t){var e=this;return new Promise((function(o,i){var n=function(r){var s=r.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var c=a.errCode,l=a.seqId;h===u.RESET_BOARD&&t===l&&(e.removeMessageEventListener(n),0===c?o():(tt.warning("RESET_BOARD_FAILED"),i("RESET_BOARD_FAILED")))};e.addMessageEventListener(n);var r={cmd:u.RESET_BOARD,seqId:t,rts:t};e.send(r)}))},i.prototype.doClearBoard=function(t,e){var o=this;return new Promise((function(i,n){var r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var c=a.errCode,l=a.seqId;h===u.CLEAR_BOARD&&e===l&&(o.removeMessageEventListener(r),0===c?i():(tt.warning("CLEAR_BOARD_FAILED"),n("CLEAR_BOARD_FAILED")))};o.addMessageEventListener(r);var s={cmd:u.CLEAR_BOARD,seqId:e,data:t,rts:e};o.send(s)}))},i.prototype.doSetBoardRatio=function(t){var e=this;return new Promise((function(o,i){var n=""+Date.now(),r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var c=a.errCode,l=a.seqId;h===u.BOARD_RATIO&&n===l&&(e.removeMessageEventListener(r),0===c?o():(tt.warning("BOARD_RATIO_FAILED"),i("BOARD_RATIO_FAILED")))};e.addMessageEventListener(r);var s={cmd:u.BOARD_RATIO,seqId:n,rts:n,data:t};e.send(s)}))},i.prototype.doScaleBoard=function(t,e){var o=this;return new Promise((function(i,n){var r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var c=a.errCode,l=a.seqId;h===u.SCALE_BOARD&&e===l&&(o.removeMessageEventListener(r),0===c?i():(tt.warning("SCALE_BOARD_FAILED"),n("SCALE_BOARD_FAILED")))};o.addMessageEventListener(r);var s={cmd:u.SCALE_BOARD,seqId:e,rts:e,data:t};o.send(s)}))},i.prototype.doUpdateBoardBackgroundColor=function(t,e){var o=this;return new Promise((function(i,n){var r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var c=a.errCode,l=a.seqId;h===u.UPDATE_BACKGROUND&&e===l&&(o.removeMessageEventListener(r),0===c?i():(tt.warning("UPDATE_BACKGROUND_FAILED"),n("UPDATE_BACKGROUND_FAILED")))};o.addMessageEventListener(r);var s={cmd:u.UPDATE_BACKGROUND,seqId:e,rts:e,data:t};o.send(s)}))},i.prototype.doUpdateBoardBackgroundImage=function(t){var e=this;return new Promise((function(o,i){var n=""+Date.now(),r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var c=a.errCode,l=a.seqId;h===u.UPDATE_BACKGROUND_IMAGE&&n===l&&(e.removeMessageEventListener(r),0===c?o():(tt.warning("UPDATE_BACKGROUND_IMAGE_FAILED"),i("UPDATE_BACKGROUND_IMAGE_FAILED")))};e.addMessageEventListener(r);var s={cmd:u.UPDATE_BACKGROUND_IMAGE,seqId:n,rts:n,data:t};e.send(s)}))},i.prototype.doAddShape=function(t,e){var o=this;return new Promise((function(i,n){var r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var c=a.errCode,l=a.seqId;h===u.ADD_SHAPE&&e===l&&(o.removeMessageEventListener(r),0===c?i():(tt.warning("ADD_SHAPE_FAILED"),n("ADD_SHAPE_FAILED")))};o.addMessageEventListener(r);var s={cmd:u.ADD_SHAPE,seqId:e,rts:e,data:t};o.send(s)}))},i.prototype.doMoveShape=function(t,e){var o=this;return new Promise((function(i,n){var r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var c=a.errCode,l=a.seqId;h===u.MOVE_SHAPE&&e===l&&(o.removeMessageEventListener(r),0===c?i():(tt.warning("MOVE_SHAPE_FAILED"),n("MOVE_SHAPE_FAILED")))};o.addMessageEventListener(r);var s={cmd:u.MOVE_SHAPE,seqId:e,rts:e,data:t};o.send(s)}))},i.prototype.doDeleteShape=function(t,e){var o=this;return new Promise((function(i,n){var r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var c=a.errCode,l=a.seqId;h===u.DELETE_SHAPE&&e===l&&(o.removeMessageEventListener(r),0===c?i():(tt.warning("DELETE_SHAPE_FAILED"),n("DELETE_SHAPE_FAILED")))};o.addMessageEventListener(r);var s={cmd:u.DELETE_SHAPE,seqId:e,rts:e,data:t};o.send(s)}))},i.prototype.disconnectServer=function(e){var o=this;if(o._clearKeepALiveTimeout(),o.clear(),e)switch(e){case"UID_BANNED":case"TOKEN_INVALID":case"FORCE_OFFLINE":o._emitConnectionState(t.EConnectionState.DISCONNECTED,e)}else o._emitConnectionState(t.EConnectionState.DISCONNECTED,"LEAVE")},i.prototype.clearEventEmitter=function(){this.removeAllListeners()},i.prototype._setConnectTimeout=function(){this._clearConnectTimeout()},i.prototype._clearConnectTimeout=function(){this._connectTimeout&&clearTimeout(this._connectTimeout)},i.prototype._clearKeepALiveTimeout=function(){var t=this;t._keepAliveTimeout&&(clearTimeout(t._keepAliveTimeout),t._keepAliveTimeout=0)},i.prototype._emitConnectionState=function(e,o){e===t.EConnectionState.DISCONNECTED&&tt.debug("[signal] bNode websocket closed, reason: "+o),this.revState=this.curState,this.curState=e,this.handleMediaServerEvents&&this.handleMediaServerEvents("connection-state-change",{curState:this.curState,revState:this.revState,reason:o})},i}(_t),Et={},yt=function(){return function(){var t,e,o=void 0,i=navigator.userAgent,n=i.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];"Chrome"===n[1]&&null!=(o=i.match(/(OPR(?=\/))\/?(\d+)/i))&&(n=o),"Safari"===n[1]&&null!=(o=i.match(/version\/(\d+)/i))&&(n[2]=o[1]),~i.toLowerCase().indexOf("qqbrowser")&&null!=(o=i.match(/(qqbrowser(?=\/))\/?(\d+)/i))&&(n=o),~i.toLowerCase().indexOf("micromessenger")&&null!=(o=i.match(/(micromessenger(?=\/))\/?(\d+)/i))&&(n=o),~i.toLowerCase().indexOf("edge")&&null!=(o=i.match(/(edge(?=\/))\/?(\d+)/i))&&(n=o),~i.toLowerCase().indexOf("trident")&&null!=(o=/\brv[ :]+(\d+)/g.exec(i)||[])&&(n=[null,"IE",o[1]]);var r=void 0;try{for(var a=s([{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}]),h=a.next();!h.done;h=a.next()){var c=h.value;if(c.r.test(navigator.userAgent)){r=c.s;break}}}catch(e){t={error:e}}finally{try{h&&!h.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}return{name:n[1],version:n[2],os:r}}()},gt=function(){return yt().os};Et.getBrowserInfo=yt,Et.getBrowserOS=gt,Et.isChrome=function(){var t=yt();return t.name&&"Chrome"===t.name},Et.isSafari=function(){var t=yt();return t.name&&"Safari"===t.name},Et.isEdge=function(){var t=yt();return t.name&&"Edge"===t.name},Et.isFireFox=function(){var t=yt();return t.name&&"Firefox"===t.name},Et.isOpera=function(){var t=yt();return t.name&&"OPR"===t.name},Et.isQQBrowser=function(){var t=yt();return t.name&&"QQBrowser"===t.name},Et.isWeChatBrowser=function(){var t=yt();return t.name&&"MicroMessenger"===t.name},Et.isSupportedPC=function(){var t=gt();return"Linux"===t||"Mac OS X"===t||"Mac OS"===t||-1!==t.indexOf("Windows")},Et.isSupportedMobile=function(){var t=gt();return"Android"===t||"iOS"===t},Et.getBrowserVersion=function(){return yt().version},Et.isChromeKernel=function(){return!!navigator.userAgent.match(/chrome\/[\d]./i)},Et.isLegacyChrome=function(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35};var St=Et.isChrome()&&Et.getBrowserVersion()>=87,Tt=function(e){function s(t){var o=e.call(this)||this;o._cmdEncrypt=!1,o._appId="",o._serverIsWss=!0,o._serverUrl="",o._serverPort=0,o._userId=null,o._connectTimeout=0,o._keepAliveTimeout=0,o._keepALiveInterval=0,o._keepALiveIntervalTime=1e4,o.handleMediaServerEvents=function(){};var i=o;return t&&t.appId&&(i._appId=t.appId),o}return o(s,e),s.prototype.init=function(t){var e=this,o=t.appId,i=t.isWss,n=t.url,r=t.port;e._appId=o,"boolean"==typeof i&&(e._serverIsWss=i),n&&(e._serverUrl=n),r&&(e._serverPort=r)},s.prototype.setAppInfo=function(t){var e=t.appId;this._appId=e},s.prototype.configServer=function(t,e,o){var i=this;i._serverIsWss=t,i._serverUrl=e,i._serverPort=o},s.prototype.connectServer=function(){var e=this,o=this;return new Promise((function(i,s){return n(e,void 0,void 0,(function(){var e,n,h,c=this;return r(this,(function(r){switch(r.label){case 0:return o._emitConnectionState(t.EConnectionState.CONNECTING),o._setConnectTimeout(),[4,ft(o.open({url:o._serverUrl,wss:o._serverIsWss,port:o._serverPort}))];case 1:return e=a.apply(void 0,[r.sent(),2]),(n=e[0])?(o._clearConnectTimeout(),s(n)):(h=(o._serverIsWss?"wss":"ws")+"://"+o._serverUrl+":"+o._serverPort,tt.debug("[ws-client] websocket opened: "+h),o._clearConnectTimeout(),o._emitConnectionState(t.EConnectionState.CONNECTED),o.onmessage=function(t){var e=t.data,i=JSON.parse(e),n=i.Cmd;i.Encrypt;var r=i.Content,s=JSON.parse(r);switch(n){case"KeepAlive":o._clearKeepALiveTimeout();break;case"ReqKeepAlive":c.doKeepAlive();break;case"Login":!St&&o._startKeepAlive();break;default:o.handleMediaServerEvents&&o.handleMediaServerEvents(n,s)}},o.onerror=function(t){tt.error("rtm server handle some error ",t)},o.onclose=function(e){var i=e.code,n=e.reason;switch(tt.info("rtm serve disconnected...",i),o._clearConnectTimeout(),o._stopKeepAlive(),o._clearKeepALiveTimeout(),i){case 1e3:case 1005:o._emitConnectionState(t.EConnectionState.DISCONNECTED,"LEAVE");break;case 3001:o._emitConnectionState(t.EConnectionState.RECONNECTING,"NETWORK_ERROR");break;default:tt.debug("mNode ws serve disconnected with code "+i+", reason "+n),o.curState!==t.EConnectionState.RECONNECTING&&o._emitConnectionState(t.EConnectionState.RECONNECTING,"SERVER_ERROR")}o.clear()},i()),[2]}}))}))}))},s.prototype.doKeepAlive=function(){var e=this,o={Cmd:"KeepAlive"};o.Encrypt=this._cmdEncrypt,o.Content=JSON.stringify({time:Date.now().toString()}),this.send(o),!e._keepAliveTimeout&&(e._keepAliveTimeout=setTimeout((function(){e._stopKeepAlive(),e._clearKeepALiveTimeout(),e.clear(),e._emitConnectionState(t.EConnectionState.RECONNECTING,"KEEP_A_LIVE_TIME_OUT")}),2*e._keepALiveIntervalTime))},s.prototype.doOnline=function(t){var e=this;return new Promise((function(o,n){var r=function(t){var i=t.data,s=JSON.parse(i),a=s.Cmd;s.Encrypt;var h=s.Content,c=JSON.parse(h);if("Login"===a){e.removeMessageEventListener(r);var l=c.Code;if(0===l){var d=c.UserId;e._userId=d,o(d)}else tt.error("user online failure, code => ",l),n(l)}};e.addMessageEventListener(r);var s={Cmd:"Login"};s.AppId=e._appId,s.Encrypt=e._cmdEncrypt;var a=i({},t);St&&(a.SvrKeepAlive=!0),s.Content=JSON.stringify(a),e.send(s)}))},s.prototype.doOffline=function(){var t=this;return new Promise((function(e,o){var i=function(n){var r=n.data,s=JSON.parse(r),a=s.Cmd;s.Encrypt;var h=s.Content,c=JSON.parse(h);if("Logout"===a){t.removeMessageEventListener(i);var l=c.Code;0===l?e(l):o(l)}};t.addMessageEventListener(i);var n={Cmd:"Logout"};n.Encrypt=t._cmdEncrypt,n.Content="",t.send(n)}))},s.prototype.doJoinChannel=function(t){var e=this;return new Promise((function(o,i){var n=function(t){var r=t.data,s=JSON.parse(r),a=s.Cmd;s.Encrypt;var h=s.Content,c=JSON.parse(h);if("JoinChannel"===a){e.removeMessageEventListener(n);var l=c.Code;c.ChanId,0===l?o():i(l)}};e.addMessageEventListener(n);var r={Cmd:"JoinChannel"};r.Encrypt=e._cmdEncrypt,r.Content=JSON.stringify(Object.assign({ChanId:t})),e.send(r)}))},s.prototype.doSendChannelMsg=function(t,e,o,i){void 0===i&&(i=!1);var n=this;return new Promise((function(r,s){var a=Z(),h=function(t){var e=t.data,o=JSON.parse(e),i=o.Cmd;o.Encrypt;var c=o.Content,l=JSON.parse(c);if("SendChannelMsg"===i){var d=l.Code;l.ChanId;var p=l.MsgId;a===p&&(n.removeMessageEventListener(h),0===d?r():s(d))}};n.addMessageEventListener(h);var c={Cmd:"SendChannelMsg"};c.Encrypt=n._cmdEncrypt,c.Content=JSON.stringify(Object.assign({ChanId:e,FromUId:n._userId,MsgId:a,MsgType:t,MsgBody:o,HistoryMsg:i,Desc:""})),n.send(c)}))},s.prototype.disconnectServer=function(e){var o=this;if(o._stopKeepAlive(),o._clearKeepALiveTimeout(),o.clear(),e)switch(e){case"UID_BANNED":case"TOKEN_INVALID":case"FORCE_OFFLINE":o._emitConnectionState(t.EConnectionState.DISCONNECTED,e)}else o._emitConnectionState(t.EConnectionState.DISCONNECTED,"LEAVE")},s.prototype.clearEventEmitter=function(){this.removeAllListeners()},s.prototype._setConnectTimeout=function(){var t=this;t._clearConnectTimeout(),t._connectTimeout=window.setTimeout((function(){t._emitConnectionState("DISCONNECTING","NETWORK_ERROR")}),1e4)},s.prototype._startKeepAlive=function(){var t=this;t._stopKeepAlive(),t.doKeepAlive(),t._keepALiveInterval=setInterval((function(){t.doKeepAlive()}),t._keepALiveIntervalTime)},s.prototype._stopKeepAlive=function(){this._keepALiveInterval&&clearInterval(this._keepALiveInterval)},s.prototype._clearConnectTimeout=function(){this._connectTimeout&&clearTimeout(this._connectTimeout)},s.prototype._clearKeepALiveTimeout=function(){var t=this;t._keepAliveTimeout&&(clearTimeout(t._keepAliveTimeout),t._keepAliveTimeout=0)},s.prototype._emitConnectionState=function(e,o){e===t.EConnectionState.DISCONNECTED&&tt.debug("[signal] mNode websocket closed, reason: "+o),this.revState=this.curState,this.curState=e,this.handleMediaServerEvents&&this.handleMediaServerEvents("connection-state-change",{curState:this.curState,revState:this.revState,reason:o})},s}(_t),mt=function(){function t(t){this.queues=[],this.maxNumber=1/0,t&&(this.maxNumber=t)}return t.prototype.add=function(t){var e,o,i=[];Array.isArray(t)?i=t:i.push(t);try{for(var n=s(i),r=n.next();!r.done;r=n.next()){var a=r.value;if(this.size+1>this.maxNumber)break;this.queues.push(a)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(e)throw e.error}}},t.prototype.dequeue=function(){this.queues.length>0&&this.queues.shift()},t.prototype.front=function(){return this.queues.length>0?this.queues[0]:void 0},t.prototype.clear=function(){this.queues=[]},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this.queues.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.queues.length},enumerable:!1,configurable:!0}),t}(),bt=function(e){function i(o,i,n,r){var s=e.call(this)||this;return s._appId="",s._uId="",s._channel="",s._token="",s._rtmSignal=void 0,s._boardSignal=void 0,s._connectState=t.EConnectionState.DISCONNECTED,s._reportBoardDataTimer=void 0,s._reportItem=void 0,s._reportQueue=new mt,s._reportLts=0,s._appId=o,s._uId=i,s._channel=n,s._token=r,s._gateWay=new ut,s}return o(i,e),Object.defineProperty(i.prototype,"connectState",{get:function(){return this._connectState},enumerable:!1,configurable:!0}),i.prototype.connectServer=function(){return n(this,void 0,void 0,(function(){var e,o,i,n,h,c,d,p,u,f,v,E,y,g,S,T,m,b,C,A,I,D,x,R,O,L,P;return r(this,(function(r){switch(r.label){case 0:return this._connectState!==t.EConnectionState.RECONNECTING&&(this._connectState=t.EConnectionState.CONNECTING),e=new URL(l.GATEWAY_ADDRESS),[4,ft(this._gateWay.joinGateway({appId:this._appId,uid:this._uId,cname:this._channel,token:this._token,cType:0,wss:"https:"===e.protocol}))];case 1:if(o=a.apply(void 0,[r.sent(),2]),i=o[0],n=o[1],i)return[2,Promise.reject(i)];if(h=n.code,c=n.accessToken,d=n.addresses,p=n.boardAddr,u=n.sessionid,0!==h)return[3,19];if(this._boardSignal=new vt({appId:this._appId}),this._boardSignal.handleMediaServerEvents=this._handleBoardServerEvents.bind(this),this._rtmSignal=new Tt({appId:this._appId}),this._rtmSignal.handleMediaServerEvents=this._handleRTMServerEvent.bind(this),!(p.length>0&&d.length>0))return[3,18];f=!1,r.label=2;case 2:r.trys.push([2,7,8,9]),v=s(p),E=v.next(),r.label=3;case 3:return E.done?[3,6]:(b=E.value,C=b.addr,A=b.port,I=b.wss,[4,ft(this._connectBoardServer(I,C,A,c))]);case 4:if(y=a.apply(void 0,[r.sent(),2]),!y[0])return f=!0,[3,6];r.label=5;case 5:return E=v.next(),[3,3];case 6:return[3,9];case 7:return g=r.sent(),R={error:g},[3,9];case 8:try{E&&!E.done&&(O=v.return)&&O.call(v)}finally{if(R)throw R.error}return[7];case 9:if(!f)return tt.info("服务连接断开，准备重连中...."),this._connectState=t.EConnectionState.RECONNECTING,this.reconnectServer("BOARD_SERVER_ERROR"),[2,Promise.reject(new nt(B,"connect bNode failed"))];S=!1,r.label=10;case 10:r.trys.push([10,15,16,17]),T=s(d),m=T.next(),r.label=11;case 11:return m.done?[3,14]:(b=m.value,C=b.addr,A=b.port,I=b.wss,[4,ft(this._connectRTMServer(I,C,A,u,c))]);case 12:if(D=a.apply(void 0,[r.sent(),2]),!D[0])return S=!0,[3,14];r.label=13;case 13:return m=T.next(),[3,11];case 14:return[3,17];case 15:return x=r.sent(),L={error:x},[3,17];case 16:try{m&&!m.done&&(P=T.return)&&P.call(T)}finally{if(L)throw L.error}return[7];case 17:return S?(this._connectState=t.EConnectionState.CONNECTED,this.emit(_.CONNECTION_STATE_CHANGE,this._connectState,""),tt.info("auth gateway success. begin get channel info..."),this._boardSignal.doGetChannelInfo(),[3,19]):(tt.info("服务连接断开，准备重连中...."),this._connectState=t.EConnectionState.RECONNECTING,this.reconnectServer("RTM_SERVER_ERROR"),[2,Promise.reject(new nt(B,"connect mNode failed"))]);case 18:return[2,Promise.reject(new nt(w))];case 19:return[2]}}))}))},i.prototype.disconnectServer=function(e){var o,i;this._connectState=t.EConnectionState.DISCONNECTING,null===(o=this._boardSignal)||void 0===o||o.disconnectServer(e),null===(i=this._rtmSignal)||void 0===i||i.disconnectServer(e),this._boardSignal.handleMediaServerEvents=function(){},this._rtmSignal.handleMediaServerEvents=function(){},this._boardSignal=void 0,this._rtmSignal=void 0,this._reportItem=void 0,this._connectState=t.EConnectionState.DISCONNECTED,this.emit(_.CONNECTION_STATE_CHANGE,this._connectState,e||"")},i.prototype.reconnectServer=function(e){var o,i,n=this;this._connectState=t.EConnectionState.RECONNECTING,null===(o=this._boardSignal)||void 0===o||o.disconnectServer(e),null===(i=this._rtmSignal)||void 0===i||i.disconnectServer(e),this._boardSignal.handleMediaServerEvents=function(){},this._rtmSignal.handleMediaServerEvents=function(){},this._boardSignal=void 0,this._rtmSignal=void 0,this._reportItem=void 0,setTimeout((function(){n.emit(_.CONNECTION_STATE_CHANGE,n._connectState,e),tt.debug("reconnect server... "),n.connectServer()}),6e3)},i.prototype.report=function(t){this._reportQueue.add(t),this._checkAndAutoStartQueue()},i.prototype._checkAndAutoStartQueue=function(){!this._reportBoardDataTimer&&this._reportQueue.size>0&&(this._reportBoardDataTimer=requestAnimationFrame(this._reportBoardData.bind(this)))},i.prototype._reportBoardData=function(e){return n(this,void 0,void 0,(function(){var o,i,n,s,a,h;return r(this,(function(r){switch(r.label){case 0:return this._connectState!==t.EConnectionState.CONNECTED?[3,26]:this._reportQueue.size>0?(o=this._reportQueue.front(),this._reportItem===o?[3,24]:(this._reportItem=o,i=o.type,n=o.data,s=o.rts,a=o.callback,h=[],i!==u.ADD_FILE?[3,2]:[4,ft(this._boardSignal.doAddFile(n,s))])):[3,25];case 1:return h=r.sent(),[3,23];case 2:return i!==u.ADD_SHAPE?[3,4]:[4,ft(this._boardSignal.doAddShape(n,s))];case 3:return h=r.sent(),[3,23];case 4:return i!==u.MOVE_SHAPE?[3,6]:[4,ft(this._boardSignal.doMoveShape(n,s))];case 5:return h=r.sent(),[3,23];case 6:return i!==u.DELETE_SHAPE?[3,8]:[4,ft(this._boardSignal.doDeleteShape(n,s))];case 7:return h=r.sent(),[3,23];case 8:return i!==u.ADD_BOARD?[3,10]:[4,ft(this._boardSignal.doAddBoard(n,s))];case 9:return(h=r.sent())[0]||a&&a(),[3,23];case 10:return i!==u.DELETE_BOARD?[3,12]:[4,ft(this._boardSignal.doDeleteBoard(n,s))];case 11:return(h=r.sent())[0]||a&&a(),[3,23];case 12:return i!==u.SWITCH_BOARD?[3,14]:[4,ft(this._boardSignal.doSwitchBoard(n,s))];case 13:return(h=r.sent())[0]||a&&a(),[3,23];case 14:return i!==u.SCALE_BOARD?[3,16]:[4,ft(this._boardSignal.doScaleBoard(n,s))];case 15:return(h=r.sent())[0]||a&&a(),[3,23];case 16:return i!==u.CLEAR_BOARD?[3,18]:[4,ft(this._boardSignal.doClearBoard(n,s))];case 17:return(h=r.sent())[0],[3,23];case 18:return i!==u.RESET_BOARD?[3,20]:[4,ft(this._boardSignal.doResetBoard(s))];case 19:return(h=r.sent())[0]||a&&a(),[3,23];case 20:return i!==u.UPDATE_BACKGROUND?[3,22]:[4,ft(this._boardSignal.doUpdateBoardBackgroundColor(n,s))];case 21:return(h=r.sent())[0]||a&&a(),[3,23];case 22:u.UPDATE_BACKGROUND_IMAGE,r.label=23;case 23:h[0]||this._reportQueue.dequeue(),r.label=24;case 24:return this._reportLts=e,[3,26];case 25:if(e-this._reportLts>3e3)return cancelAnimationFrame(this._reportBoardDataTimer),this._reportBoardDataTimer=void 0,this._reportItem=void 0,this._reportLts=0,[2];r.label=26;case 26:return requestAnimationFrame(this._reportBoardData.bind(this)),[2]}}))}))},i.prototype._handleBoardServerEvents=function(e,o){if("connection-state-change"===e){var i=o.curState,n=o.reason;o.revState,tt.debug("board connection-state-change ",i),i===t.EConnectionState.RECONNECTING&&this._connectState!==t.EConnectionState.RECONNECTING&&(this._reportBoardDataTimer&&(this._reportQueue.clear(),this._reportItem=void 0,cancelAnimationFrame(this._reportBoardDataTimer)),this.reconnectServer(n))}else this.emit(e,o)},i.prototype._handleRTMServerEvent=function(e,o){if("connection-state-change"===e){var i=o.curState,n=o.reason;o.revState,tt.debug("rtm connection-state-change ",i),i===t.EConnectionState.RECONNECTING&&this._connectState!==t.EConnectionState.RECONNECTING&&(this._reportBoardDataTimer&&(this._reportQueue.clear(),this._reportItem=void 0,cancelAnimationFrame(this._reportBoardDataTimer)),this.reconnectServer(n))}else"ForceOffline"===e?(this._reportBoardDataTimer&&(this._reportQueue.clear(),this._reportItem=void 0,cancelAnimationFrame(this._reportBoardDataTimer)),this.disconnectServer("FORCE_OFFLINE")):this.emit(e,o)},i.prototype._connectBoardServer=function(e,o,i,s){return n(this,void 0,void 0,(function(){return r(this,(function(n){return this._boardSignal.configServer(e,o,i),this._connectState===t.EConnectionState.CONNECTING||this._connectState===t.EConnectionState.RECONNECTING?[2,this._boardSignal.connectServer(this._channel,this._uId,s)]:[2]}))}))},i.prototype._connectRTMServer=function(t,e,o,i,s){return n(this,void 0,void 0,(function(){var a=this;return r(this,(function(h){switch(h.label){case 0:return this._rtmSignal.configServer(t,e,o),[4,this._rtmSignal.connectServer().then((function(){return n(a,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return t={UserId:this._uId,UserSId:"",AcsToken:s,SdkVer:"",SessionId:i},[4,this._rtmSignal.doOnline(t)];case 1:return[2,e.sent()]}}))}))})).then((function(){return n(a,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this._rtmSignal.doJoinChannel(this._channel)];case 1:return[2,t.sent()]}}))}))}))];case 1:return[2,h.sent()]}}))}))},i}(it),Ct={id:"",channel:"",appId:"",userId:"",token:"",baseParams:{scale:100,toolType:t.EBoardToolType.FREE_DRAW,progressBarUrl:l.LOADING_ICON},styleParams:{textStyle:t.EBoardTextStyle.NORMAL,textSize:16,textColor:"#333333",brushColor:"#333333",brushThin:5,globalBackgroundColor:l.BOARD_BACKGROUND_COLOR,selectBoxColor:l.BOARD_SELECT_STYLE.strokeStyle},authParams:{drawEnable:!0,progressEnable:!1}},At=function(e){function s(t){var o=e.call(this)||this;o.uid="",o._appid="",o._channel="",o._token="",o._fileId="#DEFAULT",o._fileList=new Map,o._boardId="",o._fileBoardData=new Map,o._curMaxBoardPage=1,o._renderFrameRate=5,o._initConfig=Ct,o._fusionServer=void 0;var n=t.id,r=t.channel,s=t.appId,a=t.userId,h=t.token,c=t.baseParams,l=t.styleParams,d=t.serverParams,p=t.authParams;o._appid=s,o._channel=r,o.uid=a,o._token=h||"";var u=i(i({},Ct.baseParams),c),_=i(i({},Ct.styleParams),l),f=i(i({},Ct.authParams),p);return d&&"{}"===JSON.stringify(d)&&o._setParameters(d),o._initConfig=i(i({},t),{baseParams:u,styleParams:_,authParams:f}),o._initPainter(n,o._initConfig),o._joinChannel(),o}return o(s,e),Object.defineProperty(s.prototype,"_currentBoardPage",{get:function(){var t=this._fileList.get(this._fileId);return t?t.currentPageIndex:1},set:function(t){var e=this._fileList.get(this._fileId);e&&(e.currentPageIndex=t)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"_totalBoardCount",{get:function(){var t=this._fileList.get(this._fileId);return t?t.totalPageCount:1},set:function(t){var e=this._fileList.get(this._fileId);e&&(e.totalPageCount=t)},enumerable:!1,configurable:!0}),s.prototype[_.ADD_BOARD]=function(t,e){},s.prototype[_.DELETE_BOARD]=function(t,e){},s.prototype[_.GOTO_BOARD]=function(t,e){},s.prototype[_.SCALE_BOARD]=function(t,e){},s.prototype[_.CAN_UNDO_STATUS_CHANGE]=function(t){},s.prototype[_.CAN_REDO_STATUS_CHANGE]=function(t){},s.prototype[_.CONNECTION_STATE_CHANGE]=function(t,e){},s.prototype[_.BOARD_BACKGROUND_COLOR_CHANGE]=function(t,e,o){},s.prototype[_.CLEAR_BOARD]=function(t,e){},s.prototype[_.RESET_BOARD]=function(){},s.prototype[_.ERROR]=function(t,e){},s.prototype[_.WARNING]=function(t,e){},s.prototype.getVersion=function(){return l.SDK_VERSION},s.prototype.destroy=function(){this._leaveChannel()},s.prototype._setParameters=function(t){var e=t.ConfPriCloudAddr,o=t.ConfPriCloudAddr1;if(tt.debug("set parameters config as "+JSON.stringify(t)),e){var i=e.ServerAdd,n=e.Port,r=!0;"boolean"==typeof(s=e.Wss)&&(r=s),l.GATEWAY_ADDRESS_SSL!==r&&(l.GATEWAY_ADDRESS_SSL=r),l.GATEWAY_ADDRESS1&&(l.GATEWAY_ADDRESS1=""),i&&(l.GATEWAY_ADDRESS=(r?"https://"+i:"http://"+i)+(n?":"+n:""))}if(o){var s;i=o.ServerAdd,n=o.Port,r=!0;"boolean"==typeof(s=o.Wss)&&(r=s),l.GATEWAY_ADDRESS_SSL!==r&&(l.GATEWAY_ADDRESS_SSL=r),i&&(l.GATEWAY_ADDRESS1=(r?"https://"+i:"http://"+i)+(n?":"+n:""))}},s.prototype.setBoardStyleParams=function(t){var e=this._initConfig;e.baseParams;var o=e.styleParams;if(Object.assign(o,t),o&&"{}"===JSON.stringify(o)){var i=o.textSize,n=o.textColor,r=o.brushColor,s=o.brushThin,a=o.selectBoxColor,h=o.globalBackgroundColor;i&&"number"!=typeof i&&(o.textSize=16),"string"!=typeof n&&(o.textColor="#333333"),"string"!=typeof r&&(o.brushColor="#333333"),s&&"number"!=typeof s&&s<5&&(o.brushThin=5),"string"!=typeof a&&(o.selectBoxColor="#eeeeee"),"string"!=typeof h&&(o.globalBackgroundColor="#ffffff")}},s.prototype.setBackgroundColor=function(e){var o;if(this._fusionServer&&this._fusionServer.connectState===t.EConnectionState.CONNECTED){var i={bId:this._boardId,color:e};null===(o=this._fusionServer)||void 0===o||o.report({type:u.UPDATE_BACKGROUND,data:i,rts:""+Date.now(),callback:function(){}}),this._setBoardBGColor(this._boardId,i.color)}},s.prototype.getBackgroundColor=function(){return this._painter.backgroundColor},s.prototype.setGlobalBackgroundColor=function(e){var o;this._fusionServer&&this._fusionServer.connectState===t.EConnectionState.CONNECTED&&(null===(o=this._fusionServer)||void 0===o||o.report({type:u.UPDATE_BACKGROUND,data:{bId:this._boardId,color:e},rts:""+Date.now()}),this._setGlobalBoardBGColor(e))},s.prototype.getGlobalBackgroundColor=function(){return this._initConfig.styleParams.globalBackgroundColor||""},s.prototype.setBackgroundImage=function(e){var o;this._fusionServer&&this._fusionServer.connectState===t.EConnectionState.CONNECTED&&(null===(o=this._fusionServer)||void 0===o||o.report({type:u.UPDATE_BACKGROUND_IMAGE,data:{bId:this._boardId,image:e},rts:""+Date.now()}))},s.prototype.getCurrentFileId=function(){return this._fileId},s.prototype.getCurrentBoardId=function(){return this._boardId},s.prototype.getUndoStatus=function(){},s.prototype.getFileInfo=function(t){return this._fileList.get(t)},s.prototype.addBoard=function(){var e;if("#DEFAULT"!==this._fileId){var o=new nt(x,"This file not allow add a new board.");throw tt.error(o),o}var i="web_"+this.uid+"_"+Date.now()+"_"+(this._curMaxBoardPage+1)+"_"+this._fileId;if(tt.info("local add board: "+i),this._fusionServer&&this._fusionServer.connectState===t.EConnectionState.CONNECTED){var n={bId:i,color:this._initConfig.styleParams.globalBackgroundColor,image:"",url:"",scale:100};null===(e=this._fusionServer)||void 0===e||e.report({type:u.ADD_BOARD,data:n,rts:""+Date.now(),callback:function(){}}),this._addBoard(n.bId)}},s.prototype.deleteBoard=function(e){var o;if("#DEFAULT"===this._fileId)if(1!==this._currentBoardPage)if(e&&"string"!=typeof e)tt.error("Error: boardId must be string.");else{var i=e||this._boardId;tt.info("local delete board: "+i);var n=this._fileBoardData.get(i);if(n){var r=n.bId;this._fusionServer&&this._fusionServer.connectState===t.EConnectionState.CONNECTED&&(null===(o=this._fusionServer)||void 0===o||o.report({type:u.DELETE_BOARD,data:{bIds:[r]},rts:""+Date.now(),callback:function(){}}),this._deleteBoard([r]))}else tt.error("Error: Can not find the board id is "+e+".")}else tt.error("Can not delete this page.");else tt.error("This file not allow delete board.")},s.prototype.getBoardList=function(){var t=[];return this._fileList.forEach((function(e){t.push.apply(t,h([],a(e.boardList)))})),t},s.prototype.getFileBoardList=function(t){var e=this._fileList.get(t);return e?e.boardList:[]},s.prototype.setBoardScale=function(e){var o;"number"==typeof e&&e>=100&&this._fusionServer&&this._fusionServer.connectState===t.EConnectionState.CONNECTED&&(null===(o=this._fusionServer)||void 0===o||o.report({type:u.SCALE_BOARD,data:{bId:this._boardId,scale:e},rts:""+Date.now(),callback:function(){}}),this._scaleBoard(this._boardId,e))},s.prototype.getBoardScale=function(){var t=this._fileBoardData.get(this._boardId);return(null==t?void 0:t.scale)||100},s.prototype.prevBoard=function(){var e,o=this;if(1!==this._currentBoardPage&&this._fusionServer&&this._fusionServer.connectState===t.EConnectionState.CONNECTED){var i=this._currentBoardPage-1,n=this._fileList.get(this._fileId).boardList[i-1];null===(e=this._fusionServer)||void 0===e||e.report({type:u.SWITCH_BOARD,data:{bId:n},rts:""+Date.now(),callback:function(){}}),o._gotoBoard(n),tt.info("switch to page "+o._currentBoardPage),o._renderCurrentPainter()}},s.prototype.nextBoard=function(){var e,o=this;if(!(this._currentBoardPage>=this._totalBoardCount)&&this._fusionServer&&this._fusionServer.connectState===t.EConnectionState.CONNECTED){var i=this._currentBoardPage+1,n=this._fileList.get(this._fileId).boardList[i-1];null===(e=this._fusionServer)||void 0===e||e.report({type:u.SWITCH_BOARD,data:{bId:n},rts:""+Date.now(),callback:function(){}}),o._gotoBoard(n),tt.info("switch to page "+o._currentBoardPage),o._renderCurrentPainter()}},s.prototype.gotoBoard=function(e){var o,i=this;this._fusionServer&&this._fusionServer.connectState===t.EConnectionState.CONNECTED&&(null===(o=this._fusionServer)||void 0===o||o.report({type:u.SWITCH_BOARD,data:{bId:e},rts:""+Date.now(),callback:function(){}}),i._gotoBoard(e),tt.info("switch to page "+i._currentBoardPage),i._renderCurrentPainter())},s.prototype.reset=function(){var e,o=this;if(!this._fusionServer||this._fusionServer.connectState!==t.EConnectionState.CONNECTED)throw new nt(R);null===(e=this._fusionServer)||void 0===e||e.report({type:u.RESET_BOARD,data:void 0,rts:""+Date.now(),callback:function(){}}),o._resetBoard(),o.emit(_.RESET_BOARD,o._fileId,o._boardId)},s.prototype.getBoardSnapshot=function(){var t;return null===(t=this._painter)||void 0===t?void 0:t.getSnapShortImage()},s.prototype.setEnable=function(t){"boolean"==typeof t?this._painter.setEnable(t):tt.error(D)},s.prototype.getEnable=function(){return this._painter.getEnable()},s.prototype.setBrushColor=function(t){var e;null===(e=this._painter)||void 0===e||e.setBrushColor(t)},s.prototype.getBrushColor=function(){return this._painter.brushColor},s.prototype.setBrushType=function(t){var e;null===(e=this._painter)||void 0===e||e.setBrushType(t)},s.prototype.getBrushType=function(){var t;return null===(t=this._painter)||void 0===t?void 0:t.brushType},s.prototype.setBrushThin=function(t){var e;null===(e=this._painter)||void 0===e||e.setBrushThin(t)},s.prototype.getBrushThin=function(){return this._painter.brushThin},s.prototype.setTextColor=function(t){var e;null===(e=this._painter)||void 0===e||e.setTextColor(t)},s.prototype.getTextColor=function(){var t;return null===(t=this._painter)||void 0===t?void 0:t.getTextColor()},s.prototype.setTextSize=function(t){var e;null===(e=this._painter)||void 0===e||e.setTextSize(t)},s.prototype.getTextSize=function(){var t;return null===(t=this._painter)||void 0===t?void 0:t.getTextSize()},s.prototype.resize=function(){var t,e=this;null===(t=this._painter)||void 0===t||t.renderSize();var o=this._fileBoardData.get(this._boardId);o&&(this._painter.clear(!0),o.pList.forEach((function(t){e._convertBrushDataAndRenderToBoard(t)})),this._painter.renderControlBox())},s.prototype.clear=function(e){var o,i,n=this._fileBoardData.get(this._boardId);e&&(this._painter.clearBackground(),n.color=null===(o=this._initConfig.styleParams)||void 0===o?void 0:o.globalBackgroundColor,n.image="",n.url=""),this._painter.clearAll(),n.pList.clear(),this._fusionServer&&this._fusionServer.connectState===t.EConnectionState.CONNECTED&&(null===(i=this._fusionServer)||void 0===i||i.report({type:u.CLEAR_BOARD,data:{bId:this._boardId,bg:!!e},rts:""+Date.now()}))},s.prototype.undo=function(){var t;this._painter.canUndoList.length>0&&(null===(t=this._painter)||void 0===t||t.undo())},s.prototype.redo=function(){var t;this._painter.canRedoList.length>0&&(null===(t=this._painter)||void 0===t||t.redo())},s.prototype._joinChannel=function(){return n(this,void 0,void 0,(function(){var e,o,i,n=this;return r(this,(function(r){switch(r.label){case 0:return(e=new bt(this._appid,this.uid,this._channel,this._token)).on("connection-state-change",(function(e,o){n.emit("connection-state-change",e,o),t.EConnectionState.CONNECTED})),e.on("RecvMsgFromPeer",this._handleP2PMsg.bind(this)),e.on("RecvMsgFromChan",this._handleChannelMsg.bind(this)),this._fusionServer=e,[4,ft(e.connectServer())];case 1:if(o=a.apply(void 0,[r.sent(),1]),i=o[0]){switch(i.code){case y:this.emit(_.ERROR,t.EBoardErrorCode.INIT_ERROR,y);break;case g:case S:case T:case m:case b:case C:case I:case A:this.emit(_.ERROR,t.EBoardErrorCode.AUTH_FAILED,i.code)}return[2]}return[2]}}))}))},s.prototype._leaveChannel=function(){var e;this._fusionServer&&this._fusionServer.connectState===t.EConnectionState.CONNECTED&&(null===(e=this._fusionServer)||void 0===e||e.disconnectServer(),this._fusionServer=void 0,this.emit(_.CONNECTION_STATE_CHANGE,t.EConnectionState.DISCONNECTED,"")),this._fileList.clear(),this._fileId="",this._initConfig=Ct,this._fileBoardData.clear(),this._channel="",this._token="",this._appid="",this.uid="",this._boardId="",this._curMaxBoardPage=1,this._painter.setEnable(!1),this._painter.clearAll(),this._painter.destroy(),this.removeAllListeners()},s.prototype.on=function(t,o){e.prototype.on.call(this,t,o)},s.prototype._initPainter=function(t,e){var o,s=this;if(!this._painter){if(!t)throw new nt(D);var a=e.baseParams,h=e.styleParams,c=i(i({ratio:"16:9",scale:100},a),h);this._painter=new ct(t,c),(null===(o=this._initConfig.authParams)||void 0===o?void 0:o.progressEnable)&&this._painter.showLoading(),this._painter.setEnable(!1),this._painter.setBrushType(c.toolType),setInterval((function(){var t,e,o=s._painter.getNeedUpdateShapeData();if(o)if(o.action===u.ADD_SHAPE){var n=o.data;s._saveToBoardBrushData(o.bId,n),null===(t=s._fusionServer)||void 0===t||t.report({type:o.action,data:i(i({},n),{bId:o.bId}),rts:""+Date.now()})}else if(o.action===u.MOVE_SHAPE){var r=o.data,a=r.pIds,h=r.offset;null===(e=s._fusionServer)||void 0===e||e.report({type:o.action,data:i(i({},o.data),{bId:o.bId}),rts:""+Date.now()});var c=s._fileBoardData.get(o.bId);c&&c.pList.forEach((function(t){if(a.includes(t.pId)){var e=[t.width*h[0],t.height*h[1]];t.position=e}}))}}),1e3/this._renderFrameRate),this._painter.on("reportContent",(function(t){return n(s,void 0,void 0,(function(){var e,o,n,s,a,h,c,l,d,p,f,v,E;return r(this,(function(r){return t&&(t.action===u.ADD_SHAPE?(e=t.data,null===(d=this._fusionServer)||void 0===d||d.report({type:t.action,data:i(i({},e),{bId:t.bId}),rts:""+Date.now()}),this._saveToBoardBrushData(t.bId,e)):t.action===u.DELETE_SHAPE?(null===(p=this._fusionServer)||void 0===p||p.report({type:t.action,data:i(i({},t.data),{bId:t.bId}),rts:""+Date.now()}),o=t.data.pIds,(n=this._fileBoardData.get(t.bId))&&n.pList.forEach((function(t){var e=t.pId;~o.indexOf(e)&&n.pList.delete(e)}))):t.action===u.MOVE_SHAPE&&(s=t.data,a=s.pIds,h=s.offset,null===(f=this._fusionServer)||void 0===f||f.report({type:t.action,data:i(i({},t.data),{bId:t.bId}),rts:""+Date.now()}),(c=this._fileBoardData.get(t.bId))&&c.pList.forEach((function(t){if(a.includes(t.pId)){var e=[t.width*h[0],t.height*h[1]];t.position=[t.position[0]+e[0],t.position[1]+e[1]]}})))),t&&((l=this._fileBoardData.get(t.bId)).canUndoList=this._painter.canUndoList,l.canRedoList=this._painter.canRedoList,this.emit(_.CAN_REDO_STATUS_CHANGE,(null===(v=this._painter)||void 0===v?void 0:v.canRedoList.length)>0),this.emit(_.CAN_UNDO_STATUS_CHANGE,(null===(E=this._painter)||void 0===E?void 0:E.canUndoList.length)>0)),[2]}))}))}))}},s.prototype._processChannelInfo=function(t){var e,o,i,n=this,r=t.fId,s=t.fileList;if(0===s.length){var a=Date.now();this._fileId="#DEFAULT",this._currentBoardPage=1,this._totalBoardCount=1,this._boardId="web_"+this.uid+"_"+a+"_"+this._currentBoardPage+"_"+this._fileId;var h=new lt;h.boardList=[this._boardId],null===(e=this._fusionServer)||void 0===e||e.report({type:u.ADD_FILE,data:h,rts:""+Date.now()}),this._fileList.set(this._fileId,h);var c=new dt;c.bId=this._boardId="web_"+this.uid+"_"+a+"_1_"+this._fileId,c.scale=(null===(i=null===(o=this._initConfig)||void 0===o?void 0:o.baseParams)||void 0===i?void 0:i.scale)||100,this._fileBoardData.set(this._boardId,c)}else{this._fileId=r,s.forEach((function(t){var e=t.boardList;t.boardList=[],e.forEach((function(e){t.boardList.push(e.bId),e.pList=new Map;var o=new dt;o.bId=e.bId,o.scale=e.scale,o.color=e.color,o.image=e.image,o.url=e.url,n._fileBoardData.set(e.bId,o)})),n._fileList.set(n._fileId,t)}));var l=this._fileList.get(this._fileId),d=l.currentPageIndex,p=l.totalPageCount,_=l.boardList;this._currentBoardPage=d,this._totalBoardCount=p,this._boardId=_[d-1];var f=_[_.length-1].split("_");this._curMaxBoardPage=Number(f[f.length-2])}},s.prototype._processBoardData=function(t){var e=this;t.data.forEach((function(t){tt.debug("convert to board ("+t.bId+") data.");var o=e._fileBoardData.get(t.bId);o&&(o.scale=t.scale,o.url=t.url,o.image=t.image,o.color=t.color,t.pList.forEach((function(t){e._saveToBoardBrushData(o.bId,t)})))}))},s.prototype._calculateScaleProps=function(t,e,o,i){var n=this._painter.width/o;if(t===p.FREE_DRAW||t===p.ARROW){var r=e.points.map((function(t){return[t[0]*n,t[1]*n]}));e.points=r}else t===p.CIRCLE||t===p.LASER_POINTER?(e.cx=e.cx*n,e.cy=e.cy*n):t===p.ELLIPSE?(e.cx*=n,e.cy*=n,e.xr*=n,e.yr*=n):t===p.LINE?(e.x*=n,e.y*=n,e.x1*=n,e.y1*=n):t===p.RECT?(e.x1*=n,e.y1*=n,e.x2*=n,e.y2*=n):t===p.TEXT&&(e.x*=n,e.y*=n,e.fontSize*=n,e.lineHeight*=n)},s.prototype._convertBrushDataToCurrentBoardSize=function(t){var e=JSON.parse(JSON.stringify(t)),o=e.width,i=e.shape,n=e.props,r=this._painter.width/o;if(i===p.FREE_DRAW||i===p.ARROW){var s=n.points.map((function(t){return[t[0]*r,t[1]*r]}));n.points=s}else i===p.LASER_POINTER?(n.cx=n.cx*r,n.cy=n.cy*r):i===p.ELLIPSE?(n.cx*=r,n.cy*=r,n.xr*=r,n.yr*=r):i===p.LINE?(n.x*=r,n.y*=r,n.x1*=r,n.y1*=r):i===p.RECT?(n.x1*=r,n.y1*=r,n.x2*=r,n.y2*=r):i===p.TEXT&&(n.x*=r,n.y*=r,n.fontSize*=r,n.lineHeight*=r,n.maxWidth*=r,n.maxHeight*=r);return e.width=this._painter.width,e.height=this._painter.height,e.position=[e.position[0]*r,e.position[1]*r],e},s.prototype._saveToBoardBrushData=function(t,e){var o=e.shape,i=e.pId,n=e.props;e.position,e.width,e.height;var r=this._fileBoardData.get(t);if(r){var s=r.pList.get(i);if(s)if(o===p.FREE_DRAW){var a=s.props.points,h=n.points;a.map((function(t){return t.toString()})).every((function(t){return h.toString().includes(t)}))||(s.props.points=a.concat(h))}else s.props=n;else r.pList.set(i,e)}},s.prototype._convertBrushDataAndRenderToBoard=function(t){var e=this._painter.width/t.width,o=this._convertBrushDataToCurrentBoardSize(t),n=o.shape,r=o.props,s=o.position,a=o.pId,h=o.style;o.width,o.height;var c=new at[n](a,{props:r,position:s,style:i(i({},h),{lineWidth:h.lineWidth*e})});this._painter.addElement(c)},s.prototype._renderCurrentPainter=function(){var t=this,e=this._fileBoardData.get(this._boardId);e&&(this._boardId=e.bId,this._painter.id=this._boardId,this._painter.setCanvasBGColor(e.color),this._painter.setCanvasBGImage(e.image),this._painter.scalePainter(e.scale),this._painter.reset(),this._painter.canUndoList=e.canUndoList,this._painter.canRedoList=e.canRedoList,e.pList.forEach((function(e){t._convertBrushDataAndRenderToBoard(e)})))},s.prototype._convertBrushDataToCurrentPainter=function(){},s.prototype._handleP2PMsg=function(t){var e,o;t.ChanId,t.FromUId;var i=t.MsgBody;t.MsgId,t.MsgType;var n=JSON.parse(i),r=n.cmd,s=n.data;if(r===u.CHAN_DATA)this._processChannelInfo(s),this._painter.id=this._boardId,this._painter.uid=this.uid;else if(r===u.CUR_BOARD_DATA){tt.info("get current board data.");var a=n.isFinished;this._processBoardData(n),this._renderCurrentPainter(),a&&((null===(e=this._initConfig.authParams)||void 0===e?void 0:e.progressEnable)&&this._painter.hideLoading(),(null===(o=this._initConfig.authParams)||void 0===o?void 0:o.drawEnable)&&this._painter.setEnable(!0),this.emit(_.DATA_SYNC_COMPLETED))}else r===u.CACHE_BOARD_DATA&&(tt.info("get cache board data."),this._processBoardData(n))},s.prototype._handleChannelMsg=function(t){var e,o,i=this;t.ChanId;var n=t.FromUId,r=t.MsgBody;t.MsgId,t.MsgType;var s=JSON.parse(r),a=s.cmd;s.bId;var h=s.data;if(n!==this.uid)if(a===u.ADD_SHAPE){var c=h.bId,l=h.pId,d=h.shape,f=h.props;if(h.style,h.width,h.height,h.offset,tt.debug("remote user add shape ("+d+" - "+l+")"),b=this._fileBoardData.get(c)){var v=b.pList.get(l);if(v)if(d===p.FREE_DRAW){var E=v.props.points,y=f.points;E.map((function(t){return t.toString()})).every((function(t){return y.toString().includes(t)}))||(v.props.points=E.concat(y))}else v.props=f;else b.pList.set(l,h);c===this._boardId&&(this._painter.clear(),b.pList.forEach((function(t){i._convertBrushDataAndRenderToBoard(t)})))}}else if(a===u.DELETE_SHAPE){var g=h.bId,S=h.pIds;tt.debug("remote user delete shapes: "+S);var T=this._fileBoardData.get(g);if(T){var m=g===this._boardId;m&&(this._painter.clearSelfLaserPoint(),this._painter.clear()),T.pList.forEach((function(t){var e=t.pId;~S.indexOf(e)?T.pList.delete(e):m&&i._convertBrushDataAndRenderToBoard(t)}))}}else if(a===u.MOVE_SHAPE){var b,C=h.bId,A=h.pIds,I=h.offset;tt.debug("remote user move shapes: "+A+", offset: "+I),(b=this._fileBoardData.get(C))&&(this._painter.clearSelfLaserPoint(),this._painter.clear(),b.pList.forEach((function(t){if(~A.indexOf(t.pId)){var e=t.width,o=t.height,n=[I[0]*e,I[1]*o];t.shape===p.LASER_POINTER?t.position=n:(t.position[0]+=n[0],t.position[1]+=n[1])}C===i._boardId&&i._convertBrushDataAndRenderToBoard(t)})))}else if(a===u.FILE_LIST){h.fId,h.fileList.forEach((function(t){var e=new lt;e.type=t.type,e.fId=t.fId,e.url=t.url,e.title=t.title,e.currentPageIndex=t.currentPageIndex,e.totalPageCount=t.totalPageCount,e.width=t.width,e.height=t.height,t.boardList.forEach((function(t){e.boardList.push(t.bId);var o=new dt;o.bId=t.bId,o.scale=t.scale,o.color=t.color,o.image=t.image,o.url=t.url,i._fileBoardData.set(t.bId,o)})),i._fileList.set(t.fId,e)}))}else if(a===u.ADD_BOARD){var D=h.bId;tt.debug("remote user add board: "+D),this._painter.releaseMouse(),this._addBoard(D)}else if(a===u.DELETE_BOARD){var x=h.bIds;tt.debug("remote user delete board: "+x),this._painter.releaseMouse(),this._deleteBoard(x)}else if(a===u.SWITCH_BOARD){var w=h.bId;tt.debug("remote user switch to board: "+w),this._painter.releaseMouse(),this._gotoBoard(w)}else if(a===u.SCALE_BOARD){var B=h,R=B.bId,O=B.scale;tt.debug("remote user scale board to "+O),this._painter.releaseMouse(),this._scaleBoard(R,O),this.emit(_.SCALE_BOARD,R,O)}else if(a===u.CLEAR_BOARD){this._painter.releaseMouse();var L=h,P=L.bId,N=L.bg;tt.debug("remote user clear board brush true, clear background "+N);var M=this._fileBoardData.get(P);M&&(M.pList.clear(),M.canUndoList=[],M.canRedoList=[],this._painter.clearAll(),N&&(this._setBoardBGColor(P,"#ffffff"),this._setBoardBGImage(P,"")),this.emit(_.CLEAR_BOARD,this._fileId,this._boardId),this.emit(_.CAN_REDO_STATUS_CHANGE,(null===(e=this._painter)||void 0===e?void 0:e.canRedoList.length)>0),this.emit(_.CAN_UNDO_STATUS_CHANGE,(null===(o=this._painter)||void 0===o?void 0:o.canUndoList.length)>0))}else if(a===u.RESET_BOARD)tt.debug("remote user rest board"),this._painter.releaseMouse(),this._resetBoard(),this.emit(_.RESET_BOARD,this._fileId,this._boardId);else if(a===u.UPDATE_BACKGROUND){var k=h.bId,W=h.color;tt.debug("remote user update background color "+W),this._setBoardBGColor(k,W),this.emit(_.BOARD_BACKGROUND_COLOR_CHANGE,this._fileId,this._boardId,W)}else if(a===u.UPDATE_BACKGROUND_IMAGE){var U=h.bId,G=h.image;tt.debug("remote user update background image "+G),this._setBoardBGImage(U,G)}else u.UPDATE_BACKGROUND_H5},s.prototype._getFileInfo=function(t){var e=this._fileList.get(t);return e||null},s.prototype._addBoard=function(t){var e,o;this._curMaxBoardPage+=1;var i=new dt;i.bId=t,i.color=this._initConfig.styleParams.globalBackgroundColor,this._fileBoardData.set(t,i);var n=this._fileList.get(this._fileId);n.boardList.push(t),this._currentBoardPage=n.boardList.length,this._totalBoardCount=n.boardList.length,this._boardId=t,tt.info("切换到第"+this._currentBoardPage+"页"),this._renderCurrentPainter(),this.emit(_.ADD_BOARD,this._fileId,[t]),this.emit(_.GOTO_BOARD,this._fileId,this._boardId),this.emit(_.CAN_REDO_STATUS_CHANGE,(null===(e=this._painter)||void 0===e?void 0:e.canRedoList.length)>0),this.emit(_.CAN_UNDO_STATUS_CHANGE,(null===(o=this._painter)||void 0===o?void 0:o.canUndoList.length)>0)},s.prototype._deleteBoard=function(t){for(var e,o,i=this._getFileInfo(this._fileId),n=i.boardList.length-1;n>-1;n--){var r=i.boardList[n];t.includes(r)&&(this._fileBoardData.delete(r),i.boardList.splice(n,1),r===this._boardId&&(this._currentBoardPage-=1,this._totalBoardCount=i.boardList.length,tt.info("切换到第"+this._currentBoardPage+"页"),this._boardId=i.boardList[this._currentBoardPage-1],this._renderCurrentPainter(),this.emit(_.GOTO_BOARD,this._fileId,this._boardId),this.emit(_.CAN_REDO_STATUS_CHANGE,(null===(e=this._painter)||void 0===e?void 0:e.canRedoList.length)>0),this.emit(_.CAN_UNDO_STATUS_CHANGE,(null===(o=this._painter)||void 0===o?void 0:o.canUndoList.length)>0)))}this.emit(_.DELETE_BOARD,this._fileId,[t])},s.prototype._gotoBoard=function(t){var e,o,i=this._getFileInfo(this._fileId),n=i.boardList.indexOf(t);this._currentBoardPage=n+1,this._totalBoardCount=i.boardList.length,this._boardId=t,tt.info("切换到第"+this._currentBoardPage+"页, 总页数 "+this._totalBoardCount),this._renderCurrentPainter(),this.emit(_.GOTO_BOARD,this._fileId,this._boardId),this.emit(_.CAN_REDO_STATUS_CHANGE,(null===(e=this._painter)||void 0===e?void 0:e.canRedoList.length)>0),this.emit(_.CAN_UNDO_STATUS_CHANGE,(null===(o=this._painter)||void 0===o?void 0:o.canUndoList.length)>0)},s.prototype._resetBoard=function(){tt.info("board reset success."),this._painter.clearAll();var t=this._getFileInfo(this._fileId);this._fileList.clear();var e=t.boardList[0],o=new dt;o.bId=e,this._boardId=e,this._fileId="#DEFAULT",t.fId=this._fileId,t.boardList=[e],this._fileBoardData.clear(),this._fileBoardData.set(e,o),this._fileList.set(this._fileId,t),this._currentBoardPage=1,this._totalBoardCount=1,this._curMaxBoardPage=1,this._boardId=e,this._renderCurrentPainter()},s.prototype._scaleBoard=function(t,e){var o=this,i=this._fileBoardData.get(t);i&&(i.scale=e),t===this._boardId&&(tt.info("白板缩放至"+e),this._painter.scalePainter(e),this._painter.clear(!0),this._painter.canUndoList=i.canUndoList,this._painter.canRedoList=i.canRedoList,i&&i.pList.forEach((function(t){o._convertBrushDataAndRenderToBoard(t)})),this._painter.renderControlBox())},s.prototype._setBoardBGColor=function(t,e){var o,i=this._fileBoardData.get(t);i&&(i.color=e),t===this._boardId&&(null===(o=this._painter)||void 0===o||o.setCanvasBGColor(e),tt.info("白板背景颜色改变为："+e))},s.prototype._setGlobalBoardBGColor=function(t){var e=this,o=this._getFileInfo(this._fileId);o&&(this._initConfig.styleParams.globalBackgroundColor=t,o.boardList.forEach((function(o){var i,n=e._fileBoardData.get(o);n.color=t,n.bId===e._boardId&&(null===(i=e._painter)||void 0===i||i.setCanvasBGColor(t))})))},s.prototype._setBoardBGImage=function(t,e){var o=this._fileBoardData.get(t);o&&(o.image=e),t===this._boardId&&(this._painter.setCanvasBGImage(e),tt.info("白板背景颜色图片改变为："+e))},s.prototype._setBoardH5=function(t,e){var o=this._fileBoardData.get(t);o&&(o.url=e),t===this._boardId&&tt.info("白板背景颜色图片改变为："+e)},s}(it);t.ArWhiteBoard=At,t.default=At,Object.defineProperty(t,"__esModule",{value:!0})}));
